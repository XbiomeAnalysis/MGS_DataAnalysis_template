[["index.html", "MGS microbiota data analysis based on XMAS package Chapter 1 Prerequisites 1.1 Preparing for the tutorial 1.2 Workflow description 1.3 Systematic Information", " MGS microbiota data analysis based on XMAS package Hua Zou 2022-05-18 Chapter 1 Prerequisites Here, we give users one example to practice the MGS microbiota data analysis workflow by XMAS 2.0. By the way, we also recommend users handling your own microbiota data in a reasonable manner when you utilize this package or workflow. Pay attention to whether your data fit the methods this package provided. 1.1 Preparing for the tutorial This tutorial requires that the users should have basic knowledge on R language and traditional statistical background. If you are new to microbial research, we recommend the Statistical Analysis of Microbiome Data with R (Xia et al. 2018) as guide book. We recommend users using local laptop because our own server have not deployed XMAS 2.0 package yet. In addition, installing the following software before using XMAS 2.0. R 3.6.3 or later release Download link. Rstudio Desktop Download link. 1.2 Workflow description The standard data analysis of 16S and MGS data by XMAS 2.0. The upstream process is performed by in-house pipeline. and this example just shows how to perform downstream data analysis. In briefly, the example comprises the following steps: Converting inputs into phyloseq object; Quality Evaluation; Pre-Processing Data; Diversity analysis; Ordination analysis; Composition analysis; Differential analysis. Figure 1.1: Functions of XMAS 2.0 in 16s 1.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 withr_2.5.0 colorspace_2.0-3 Biobase_2.54.0 ## [13] highr_0.9 knitr_1.37 rstudioapi_0.13 pscl_1.5.5 ## [17] stats4_4.1.2 robustbase_0.93-9 ggsignif_0.6.3 MatrixGenerics_1.6.0 ## [21] labeling_0.4.2 optparse_1.7.1 mbzinb_0.2 GenomeInfoDbData_1.2.7 ## [25] lpsymphony_1.22.0 pheatmap_1.0.12 bit64_4.0.5 farver_2.1.0 ## [29] rhdf5_2.38.1 vctrs_0.3.8 generics_0.1.2 TH.data_1.1-0 ## [33] xfun_0.30 Maaslin2_1.8.0 R6_2.5.1 GenomeInfoDb_1.30.1 ## [37] locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 rhdf5filters_1.6.0 ## [41] cachem_1.0.6 DelayedArray_0.20.0 assertthat_0.2.1 scales_1.1.1 ## [45] multcomp_1.4-18 nnet_7.3-17 gtable_0.3.0 sandwich_3.0-1 ## [49] rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 protoclust_1.6.3 ## [53] rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 yaml_2.3.5 ## [57] reshape2_1.4.4 abind_1.4-5 backports_1.4.1 Rfast_2.0.6 ## [61] qvalue_2.26.0 Hmisc_4.6-0 DiagrammeR_1.0.9 tools_4.1.2 ## [65] bookdown_0.24 zCompositions_1.4.0 ellipsis_0.3.2 gplots_3.1.1 ## [69] jquerylib_0.1.4 biomformat_1.22.0 RColorBrewer_1.1-2 BiocGenerics_0.40.0 ## [73] Rcpp_1.0.8.2 plyr_1.8.6 base64enc_0.1-3 visNetwork_2.1.0 ## [77] zlibbioc_1.40.0 purrr_0.3.4 RCurl_1.98-1.6 rpart_4.1.16 ## [81] Wrench_1.12.0 cowplot_1.1.1 S4Vectors_0.32.3 zoo_1.8-9 ## [85] SummarizedExperiment_1.24.0 ggrepel_0.9.1 cluster_2.1.2 magrittr_2.0.2 ## [89] data.table_1.14.2 truncnorm_1.0-8 mvtnorm_1.1-3 matrixStats_0.61.0 ## [93] ALDEx2_1.26.0 corncob_0.2.0 RAIDA_1.0 evaluate_0.15 ## [97] xtable_1.8-4 XML_3.99-0.9 jpeg_0.1-9 IRanges_2.28.0 ## [101] gridExtra_2.3 shape_1.4.6 compiler_4.1.2 KernSmooth_2.23-20 ## [105] crayon_1.5.0 htmltools_0.5.2 mgcv_1.8-39 pcaPP_1.9-74 ## [109] Formula_1.2-4 tidyr_1.2.0 geneplotter_1.72.0 libcoin_1.0-9 ## [113] DBI_1.1.2 biglm_0.9-2.1 MASS_7.3-55 Matrix_1.4-0 ## [117] ade4_1.7-18 getopt_1.20.3 car_3.0-12 permute_0.9-7 ## [121] cli_3.2.0 parallel_4.1.2 igraph_1.2.11 GenomicRanges_1.46.1 ## [125] pkgconfig_2.0.3 coin_1.4-2 foreign_0.8-82 foreach_1.5.2 ## [129] annotate_1.72.0 bslib_0.3.1 multtest_2.50.0 XVector_0.34.0 ## [133] NADA_1.6-1.1 stringr_1.4.0 digest_0.6.29 vegan_2.5-7 ## [137] Biostrings_2.62.0 rmarkdown_2.13 htmlTable_2.4.0 edgeR_3.36.0 ## [141] gtools_3.9.2 modeltools_0.2-23 lifecycle_1.0.1 nlme_3.1-155 ## [145] jsonlite_1.8.0 Rhdf5lib_1.16.0 carData_3.0-5 limma_3.50.1 ## [149] fansi_1.0.2 pillar_1.7.0 lattice_0.20-45 KEGGREST_1.34.0 ## [153] fastmap_1.1.0 httr_1.4.2 DEoptimR_1.0-10 survival_3.3-1 ## [157] glue_1.6.2 png_0.1-7 iterators_1.0.14 glmnet_4.1-3 ## [161] bit_4.0.4 stringi_1.7.6 sass_0.4.0 metagenomeSeq_1.36.0 ## [165] blob_1.2.2 DESeq2_1.34.0 latticeExtra_0.6-29 caTools_1.18.2 ## [169] memoise_2.0.1 ape_5.6-2 References "],["convert-inputdata-into-phyloseq-object.html", "Chapter 2 Convert inputdata into phyloseq object 2.1 Metaphlan2/3 2.2 Summarize phyloseq-class object 2.3 Systematic Information", " Chapter 2 Convert inputdata into phyloseq object r Biocpkg(“phyloseq”) (McMurdie and Holmes 2013) is the most popular Biocondcutor package used by the microbiome research field, and phyloseq-class objects are a great data-standard for microbiota data in R. Therefore, the core functions in XMAS take phyloseq-class object as input. In the phyloseq object, information on OTU abundances, taxonomy of OTUs, the phylogenetic tree and metadata is stored. This tutorial will introduce you the basic steps to convert results from the in-house pipeline into phyloseq-class object. More importantly on how to look at your data and filter appropriately. We will use the inputs from /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/. Loading packages library(XMAS) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) 2.1 Metaphlan2/3 The result of the in-house Metaphlan2/3 pipeline: /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/MGS/metaphlan2_merged.tsv /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/MGS/metadata.txt metaphlan2_res &lt;- read.table( system.file( &quot;extdata&quot;, &quot;metaphlan2_merged.tsv&quot;, package = &quot;XMAS&quot; ), header = TRUE, stringsAsFactors = FALSE ) metaphlan2_sam &lt;- read.table( system.file( &quot;extdata&quot;, &quot;metaphlan2_metadata.tsv&quot;, package = &quot;XMAS&quot; ), sep = &quot;\\t&quot;, header = TRUE, stringsAsFactors = FALSE ) metaphlan2_res_list &lt;- import_metaphlan_taxa(metaphlan2_res, taxa_level = &quot;Species&quot;) otu_tab &lt;- metaphlan2_res_list$abu_tab tax_tab &lt;- metaphlan2_res_list$tax_tab sam_tab &lt;- metaphlan2_sam %&gt;% tibble::column_to_rownames(&quot;SampleID&quot;) metaphlan2_ps &lt;- import_metaphlan2(otu_tab = otu_tab, sam_tab = sam_tab, tax_tab = tax_tab) metaphlan2_ps ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 326 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 326 taxa by 7 taxonomic ranks ] we obtain the phyloseq-class object and then use it to perform data analysis. Here, the phyloseq object comprises five components (OTU Table, Sample Data, and Taxonomy Table). 2.2 Summarize phyloseq-class object summarize_phyloseq(metaphlan2_ps) ## Compositional = NO2 ## 1] Min. number of reads = 0.98218212] Max. number of reads = 1.00000053] Total number of reads = 22.94511414] Average number of reads = 0.9976136565217395] Median number of reads = 0.99980247] Sparsity = 0.7131234995998936] Any OTU sum to 1 or less? YES8] Number of singletons = 3239] Percent of OTUs that are singletons ## (i.e. exactly one read detected across all samples)010] Number of sample variables are: 2Groupphynotype2 ## [[1]] ## [1] &quot;1] Min. number of reads = 0.9821821&quot; ## ## [[2]] ## [1] &quot;2] Max. number of reads = 1.0000005&quot; ## ## [[3]] ## [1] &quot;3] Total number of reads = 22.9451141&quot; ## ## [[4]] ## [1] &quot;4] Average number of reads = 0.997613656521739&quot; ## ## [[5]] ## [1] &quot;5] Median number of reads = 0.9998024&quot; ## ## [[6]] ## [1] &quot;7] Sparsity = 0.713123499599893&quot; ## ## [[7]] ## [1] &quot;6] Any OTU sum to 1 or less? YES&quot; ## ## [[8]] ## [1] &quot;8] Number of singletons = 323&quot; ## ## [[9]] ## [1] &quot;9] Percent of OTUs that are singletons\\n (i.e. exactly one read detected across all samples)0&quot; ## ## [[10]] ## [1] &quot;10] Number of sample variables are: 2&quot; ## ## [[11]] ## [1] &quot;Group&quot; &quot;phynotype&quot; Notice the Sparsity (0.713), indicating the data has many zeros and pay attention to the downstream data analysis. A common property of amplicon based microbiota data generated by sequencing. 2.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 withr_2.5.0 colorspace_2.0-3 Biobase_2.54.0 ## [13] highr_0.9 knitr_1.37 rstudioapi_0.13 pscl_1.5.5 ## [17] stats4_4.1.2 robustbase_0.93-9 ggsignif_0.6.3 MatrixGenerics_1.6.0 ## [21] labeling_0.4.2 optparse_1.7.1 mbzinb_0.2 GenomeInfoDbData_1.2.7 ## [25] lpsymphony_1.22.0 pheatmap_1.0.12 bit64_4.0.5 farver_2.1.0 ## [29] rhdf5_2.38.1 vctrs_0.3.8 generics_0.1.2 TH.data_1.1-0 ## [33] xfun_0.30 Maaslin2_1.8.0 R6_2.5.1 GenomeInfoDb_1.30.1 ## [37] locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 rhdf5filters_1.6.0 ## [41] cachem_1.0.6 DelayedArray_0.20.0 assertthat_0.2.1 scales_1.1.1 ## [45] multcomp_1.4-18 nnet_7.3-17 gtable_0.3.0 sandwich_3.0-1 ## [49] rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 protoclust_1.6.3 ## [53] rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 yaml_2.3.5 ## [57] reshape2_1.4.4 abind_1.4-5 backports_1.4.1 Rfast_2.0.6 ## [61] qvalue_2.26.0 Hmisc_4.6-0 DiagrammeR_1.0.9 tools_4.1.2 ## [65] bookdown_0.24 zCompositions_1.4.0 ellipsis_0.3.2 gplots_3.1.1 ## [69] jquerylib_0.1.4 biomformat_1.22.0 RColorBrewer_1.1-2 BiocGenerics_0.40.0 ## [73] Rcpp_1.0.8.2 plyr_1.8.6 base64enc_0.1-3 visNetwork_2.1.0 ## [77] zlibbioc_1.40.0 purrr_0.3.4 RCurl_1.98-1.6 rpart_4.1.16 ## [81] Wrench_1.12.0 cowplot_1.1.1 S4Vectors_0.32.3 zoo_1.8-9 ## [85] SummarizedExperiment_1.24.0 ggrepel_0.9.1 cluster_2.1.2 magrittr_2.0.2 ## [89] data.table_1.14.2 truncnorm_1.0-8 mvtnorm_1.1-3 matrixStats_0.61.0 ## [93] ALDEx2_1.26.0 corncob_0.2.0 RAIDA_1.0 evaluate_0.15 ## [97] xtable_1.8-4 XML_3.99-0.9 jpeg_0.1-9 IRanges_2.28.0 ## [101] gridExtra_2.3 shape_1.4.6 compiler_4.1.2 KernSmooth_2.23-20 ## [105] crayon_1.5.0 htmltools_0.5.2 mgcv_1.8-39 pcaPP_1.9-74 ## [109] Formula_1.2-4 tidyr_1.2.0 geneplotter_1.72.0 libcoin_1.0-9 ## [113] DBI_1.1.2 biglm_0.9-2.1 MASS_7.3-55 Matrix_1.4-0 ## [117] ade4_1.7-18 getopt_1.20.3 car_3.0-12 permute_0.9-7 ## [121] cli_3.2.0 parallel_4.1.2 igraph_1.2.11 GenomicRanges_1.46.1 ## [125] pkgconfig_2.0.3 coin_1.4-2 foreign_0.8-82 foreach_1.5.2 ## [129] annotate_1.72.0 bslib_0.3.1 multtest_2.50.0 XVector_0.34.0 ## [133] NADA_1.6-1.1 stringr_1.4.0 digest_0.6.29 vegan_2.5-7 ## [137] Biostrings_2.62.0 rmarkdown_2.13 htmlTable_2.4.0 edgeR_3.36.0 ## [141] gtools_3.9.2 modeltools_0.2-23 lifecycle_1.0.1 nlme_3.1-155 ## [145] jsonlite_1.8.0 Rhdf5lib_1.16.0 carData_3.0-5 limma_3.50.1 ## [149] fansi_1.0.2 pillar_1.7.0 lattice_0.20-45 KEGGREST_1.34.0 ## [153] fastmap_1.1.0 httr_1.4.2 DEoptimR_1.0-10 survival_3.3-1 ## [157] glue_1.6.2 png_0.1-7 iterators_1.0.14 glmnet_4.1-3 ## [161] bit_4.0.4 stringi_1.7.6 sass_0.4.0 metagenomeSeq_1.36.0 ## [165] blob_1.2.2 DESeq2_1.34.0 latticeExtra_0.6-29 caTools_1.18.2 ## [169] memoise_2.0.1 ape_5.6-2 References "],["quality-control.html", "Chapter 3 Quality Control 3.1 spike-in sample (BRS) 3.2 Spike-in sample’s remove 3.3 Systematic Information", " Chapter 3 Quality Control Loading packages library(XMAS) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) The taxonomic levels of spike-in sample’s bacteria is species. Firstly, using the summarize_taxa to get the genus level phyloseq object and then do run_RefCheck under the optimal parameters. 3.1 spike-in sample (BRS) metaphlan2_ps_species &lt;- summarize_taxa(metaphlan2_ps, taxa_level = &quot;Species&quot;) metaphlan2_ps_species@sam_data ## Group phynotype ## s1 BB 0.00 ## s2 AA 2.50 ## s3 BB 0.00 ## s4 AA 1.25 ## s5 AA 30.00 ## s6 AA 15.00 ## s7 BB 8.75 ## s8 BB 0.00 ## s9 BB 3.75 ## s10 BB 2.50 ## s11 BB 15.00 ## s12 BB 2.50 ## s13 BB 2.50 ## s14 BB 0.00 ## s15 BB 1.07 ## s16 BB 2.50 ## s17 AA 5.00 ## s18 BB 35.00 ## s19 BB 7.50 ## s20 BB 15.00 ## s21 AA 3.75 ## s22 AA 3.75 ## refE QC NA RefCheck_MGS &lt;- run_RefCheck( ps=metaphlan2_ps_species, BRS_ID=&quot;refE&quot;, Reference=NULL, Ref_type=&quot;MGS&quot;, Save=NULL ) 3.2 Spike-in sample’s remove metaphlan2_ps_NoQC &lt;- get_GroupPhyloseq( ps = metaphlan2_ps, group = &quot;Group&quot;, group_names = &quot;QC&quot;, discard = TRUE ) metaphlan2_ps_NoQC ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 326 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 326 taxa by 7 taxonomic ranks ] 3.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 withr_2.5.0 colorspace_2.0-3 Biobase_2.54.0 ## [13] highr_0.9 knitr_1.37 rstudioapi_0.13 pscl_1.5.5 ## [17] stats4_4.1.2 robustbase_0.93-9 ggsignif_0.6.3 MatrixGenerics_1.6.0 ## [21] labeling_0.4.2 optparse_1.7.1 mbzinb_0.2 GenomeInfoDbData_1.2.7 ## [25] lpsymphony_1.22.0 pheatmap_1.0.12 bit64_4.0.5 farver_2.1.0 ## [29] rhdf5_2.38.1 vctrs_0.3.8 generics_0.1.2 TH.data_1.1-0 ## [33] xfun_0.30 Maaslin2_1.8.0 R6_2.5.1 GenomeInfoDb_1.30.1 ## [37] locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 rhdf5filters_1.6.0 ## [41] cachem_1.0.6 DelayedArray_0.20.0 assertthat_0.2.1 scales_1.1.1 ## [45] multcomp_1.4-18 nnet_7.3-17 gtable_0.3.0 sandwich_3.0-1 ## [49] rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 protoclust_1.6.3 ## [53] rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 yaml_2.3.5 ## [57] reshape2_1.4.4 abind_1.4-5 backports_1.4.1 Rfast_2.0.6 ## [61] qvalue_2.26.0 Hmisc_4.6-0 DiagrammeR_1.0.9 tools_4.1.2 ## [65] bookdown_0.24 zCompositions_1.4.0 ellipsis_0.3.2 gplots_3.1.1 ## [69] jquerylib_0.1.4 biomformat_1.22.0 RColorBrewer_1.1-2 BiocGenerics_0.40.0 ## [73] Rcpp_1.0.8.2 plyr_1.8.6 base64enc_0.1-3 visNetwork_2.1.0 ## [77] zlibbioc_1.40.0 purrr_0.3.4 RCurl_1.98-1.6 rpart_4.1.16 ## [81] Wrench_1.12.0 cowplot_1.1.1 S4Vectors_0.32.3 zoo_1.8-9 ## [85] SummarizedExperiment_1.24.0 ggrepel_0.9.1 cluster_2.1.2 magrittr_2.0.2 ## [89] data.table_1.14.2 truncnorm_1.0-8 mvtnorm_1.1-3 matrixStats_0.61.0 ## [93] ALDEx2_1.26.0 corncob_0.2.0 RAIDA_1.0 evaluate_0.15 ## [97] xtable_1.8-4 XML_3.99-0.9 jpeg_0.1-9 IRanges_2.28.0 ## [101] gridExtra_2.3 shape_1.4.6 compiler_4.1.2 KernSmooth_2.23-20 ## [105] crayon_1.5.0 htmltools_0.5.2 mgcv_1.8-39 pcaPP_1.9-74 ## [109] Formula_1.2-4 tidyr_1.2.0 geneplotter_1.72.0 libcoin_1.0-9 ## [113] DBI_1.1.2 biglm_0.9-2.1 MASS_7.3-55 Matrix_1.4-0 ## [117] ade4_1.7-18 getopt_1.20.3 car_3.0-12 permute_0.9-7 ## [121] cli_3.2.0 parallel_4.1.2 igraph_1.2.11 GenomicRanges_1.46.1 ## [125] pkgconfig_2.0.3 coin_1.4-2 foreign_0.8-82 foreach_1.5.2 ## [129] annotate_1.72.0 bslib_0.3.1 multtest_2.50.0 XVector_0.34.0 ## [133] NADA_1.6-1.1 stringr_1.4.0 digest_0.6.29 vegan_2.5-7 ## [137] Biostrings_2.62.0 rmarkdown_2.13 htmlTable_2.4.0 edgeR_3.36.0 ## [141] gtools_3.9.2 modeltools_0.2-23 lifecycle_1.0.1 nlme_3.1-155 ## [145] jsonlite_1.8.0 Rhdf5lib_1.16.0 carData_3.0-5 limma_3.50.1 ## [149] fansi_1.0.2 pillar_1.7.0 lattice_0.20-45 KEGGREST_1.34.0 ## [153] fastmap_1.1.0 httr_1.4.2 DEoptimR_1.0-10 survival_3.3-1 ## [157] glue_1.6.2 png_0.1-7 iterators_1.0.14 glmnet_4.1-3 ## [161] bit_4.0.4 stringi_1.7.6 sass_0.4.0 metagenomeSeq_1.36.0 ## [165] blob_1.2.2 DESeq2_1.34.0 latticeExtra_0.6-29 caTools_1.18.2 ## [169] memoise_2.0.1 ape_5.6-2 "],["data-processing.html", "Chapter 4 Data processing 4.1 Extracting specific taxonomic level 4.2 Filtering the low relative abundance or unclassified taxa by the threshold (total counts &lt; 1e-4) 4.3 Trimming the taxa with low occurrence less than threshold 4.4 Systematic Information", " Chapter 4 Data processing Loading packages library(XMAS) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) This part has too may procedures and we only choose some of them. Please go to Chapter 6 to see more approaches and details for being familiar with this part. 4.1 Extracting specific taxonomic level metaphlan2_ps_species &lt;- summarize_taxa(metaphlan2_ps_NoQC, taxa_level = &quot;Species&quot;) metaphlan2_ps_species ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 325 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 325 taxa by 7 taxonomic ranks ] 4.2 Filtering the low relative abundance or unclassified taxa by the threshold (total counts &lt; 1e-4) metaphlan2_ps_species_filter &lt;- run_filter(metaphlan2_ps_species, cutoff = 1e-4, unclass = TRUE) metaphlan2_ps_species_filter ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 233 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 233 taxa by 7 taxonomic ranks ] 4.3 Trimming the taxa with low occurrence less than threshold metaphlan2_ps_species_filter_trim &lt;- run_trim(metaphlan2_ps_species_filter, cutoff = 0.2, trim = &quot;feature&quot;) metaphlan2_ps_final &lt;- metaphlan2_ps_species_filter_trim metaphlan2_ps_final ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 144 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 144 taxa by 7 taxonomic ranks ] Finally, we obtained the final phyloseq-class object metaphlan2_ps_species_filter_trim and changed its name. 4.4 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 withr_2.5.0 colorspace_2.0-3 Biobase_2.54.0 ## [13] highr_0.9 knitr_1.37 rstudioapi_0.13 pscl_1.5.5 ## [17] stats4_4.1.2 robustbase_0.93-9 ggsignif_0.6.3 MatrixGenerics_1.6.0 ## [21] labeling_0.4.2 optparse_1.7.1 mbzinb_0.2 GenomeInfoDbData_1.2.7 ## [25] lpsymphony_1.22.0 pheatmap_1.0.12 bit64_4.0.5 farver_2.1.0 ## [29] rhdf5_2.38.1 vctrs_0.3.8 generics_0.1.2 TH.data_1.1-0 ## [33] xfun_0.30 Maaslin2_1.8.0 R6_2.5.1 GenomeInfoDb_1.30.1 ## [37] locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 rhdf5filters_1.6.0 ## [41] cachem_1.0.6 DelayedArray_0.20.0 assertthat_0.2.1 scales_1.1.1 ## [45] multcomp_1.4-18 nnet_7.3-17 gtable_0.3.0 sandwich_3.0-1 ## [49] rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 protoclust_1.6.3 ## [53] rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 yaml_2.3.5 ## [57] reshape2_1.4.4 abind_1.4-5 backports_1.4.1 Rfast_2.0.6 ## [61] qvalue_2.26.0 Hmisc_4.6-0 DiagrammeR_1.0.9 tools_4.1.2 ## [65] bookdown_0.24 zCompositions_1.4.0 ellipsis_0.3.2 gplots_3.1.1 ## [69] jquerylib_0.1.4 biomformat_1.22.0 RColorBrewer_1.1-2 BiocGenerics_0.40.0 ## [73] Rcpp_1.0.8.2 plyr_1.8.6 base64enc_0.1-3 visNetwork_2.1.0 ## [77] zlibbioc_1.40.0 purrr_0.3.4 RCurl_1.98-1.6 rpart_4.1.16 ## [81] Wrench_1.12.0 cowplot_1.1.1 S4Vectors_0.32.3 zoo_1.8-9 ## [85] SummarizedExperiment_1.24.0 ggrepel_0.9.1 cluster_2.1.2 magrittr_2.0.2 ## [89] data.table_1.14.2 truncnorm_1.0-8 mvtnorm_1.1-3 matrixStats_0.61.0 ## [93] ALDEx2_1.26.0 corncob_0.2.0 RAIDA_1.0 evaluate_0.15 ## [97] xtable_1.8-4 XML_3.99-0.9 jpeg_0.1-9 IRanges_2.28.0 ## [101] gridExtra_2.3 shape_1.4.6 compiler_4.1.2 KernSmooth_2.23-20 ## [105] crayon_1.5.0 htmltools_0.5.2 mgcv_1.8-39 pcaPP_1.9-74 ## [109] Formula_1.2-4 tidyr_1.2.0 geneplotter_1.72.0 libcoin_1.0-9 ## [113] DBI_1.1.2 biglm_0.9-2.1 MASS_7.3-55 Matrix_1.4-0 ## [117] ade4_1.7-18 getopt_1.20.3 car_3.0-12 permute_0.9-7 ## [121] cli_3.2.0 parallel_4.1.2 igraph_1.2.11 GenomicRanges_1.46.1 ## [125] pkgconfig_2.0.3 coin_1.4-2 foreign_0.8-82 foreach_1.5.2 ## [129] annotate_1.72.0 bslib_0.3.1 multtest_2.50.0 XVector_0.34.0 ## [133] NADA_1.6-1.1 stringr_1.4.0 digest_0.6.29 vegan_2.5-7 ## [137] Biostrings_2.62.0 rmarkdown_2.13 htmlTable_2.4.0 edgeR_3.36.0 ## [141] gtools_3.9.2 modeltools_0.2-23 lifecycle_1.0.1 nlme_3.1-155 ## [145] jsonlite_1.8.0 Rhdf5lib_1.16.0 carData_3.0-5 limma_3.50.1 ## [149] fansi_1.0.2 pillar_1.7.0 lattice_0.20-45 KEGGREST_1.34.0 ## [153] fastmap_1.1.0 httr_1.4.2 DEoptimR_1.0-10 survival_3.3-1 ## [157] glue_1.6.2 png_0.1-7 iterators_1.0.14 glmnet_4.1-3 ## [161] bit_4.0.4 stringi_1.7.6 sass_0.4.0 metagenomeSeq_1.36.0 ## [165] blob_1.2.2 DESeq2_1.34.0 latticeExtra_0.6-29 caTools_1.18.2 ## [169] memoise_2.0.1 ape_5.6-2 "],["diversity-analysis.html", "Chapter 5 Diversity analysis 5.1 Alpha diveristy 5.2 Beta diversity 5.3 Systematic Information", " Chapter 5 Diversity analysis Loading packages library(XMAS) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) 5.1 Alpha diveristy Calculate the alpha diversity Notes: choosing the measures (Shannon, Simpson and InvSimpson) only for relative abundance. metaphlan2_ps_genus_alpha &lt;- run_alpha_diversity(ps=metaphlan2_ps_NoQC, measures = c(&quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot;)) DT::datatable(metaphlan2_ps_genus_alpha) visualization plot_boxplot(data=metaphlan2_ps_genus_alpha, y_index = c(&quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot;), group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), group_color = c(&quot;red&quot;, &quot;blue&quot;), do_test = TRUE, method = &quot;wilcox.test&quot;) Figure 5.1: Alpha diversity 5.2 Beta diversity beta dipersion metaphlan2_ps_beta &lt;- run_beta_diversity(ps=metaphlan2_ps_final, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.00725 0.0072500 0.8423 999 0.362 ## Residuals 20 0.17215 0.0086076 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## AA BB ## AA 0.37 ## BB 0.36968 metaphlan2_ps_beta$BetaDispersion Figure 5.2: Beta diversity 5.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 DT_0.21 withr_2.5.0 colorspace_2.0-3 ## [13] Biobase_2.54.0 highr_0.9 knitr_1.37 rstudioapi_0.13 ## [17] pscl_1.5.5 stats4_4.1.2 robustbase_0.93-9 ggsignif_0.6.3 ## [21] MatrixGenerics_1.6.0 labeling_0.4.2 optparse_1.7.1 mbzinb_0.2 ## [25] GenomeInfoDbData_1.2.7 lpsymphony_1.22.0 pheatmap_1.0.12 bit64_4.0.5 ## [29] farver_2.1.0 rhdf5_2.38.1 vctrs_0.3.8 generics_0.1.2 ## [33] TH.data_1.1-0 xfun_0.30 Maaslin2_1.8.0 R6_2.5.1 ## [37] GenomeInfoDb_1.30.1 locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 ## [41] rhdf5filters_1.6.0 cachem_1.0.6 DelayedArray_0.20.0 assertthat_0.2.1 ## [45] scales_1.1.1 multcomp_1.4-18 nnet_7.3-17 gtable_0.3.0 ## [49] sandwich_3.0-1 rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 ## [53] protoclust_1.6.3 rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 ## [57] yaml_2.3.5 reshape2_1.4.4 abind_1.4-5 crosstalk_1.2.0 ## [61] backports_1.4.1 Rfast_2.0.6 qvalue_2.26.0 Hmisc_4.6-0 ## [65] DiagrammeR_1.0.9 tools_4.1.2 bookdown_0.24 zCompositions_1.4.0 ## [69] ellipsis_0.3.2 gplots_3.1.1 jquerylib_0.1.4 biomformat_1.22.0 ## [73] RColorBrewer_1.1-2 BiocGenerics_0.40.0 Rcpp_1.0.8.2 plyr_1.8.6 ## [77] base64enc_0.1-3 visNetwork_2.1.0 zlibbioc_1.40.0 purrr_0.3.4 ## [81] RCurl_1.98-1.6 rpart_4.1.16 Wrench_1.12.0 cowplot_1.1.1 ## [85] S4Vectors_0.32.3 zoo_1.8-9 SummarizedExperiment_1.24.0 ggrepel_0.9.1 ## [89] cluster_2.1.2 magrittr_2.0.2 data.table_1.14.2 truncnorm_1.0-8 ## [93] mvtnorm_1.1-3 matrixStats_0.61.0 ALDEx2_1.26.0 corncob_0.2.0 ## [97] RAIDA_1.0 evaluate_0.15 xtable_1.8-4 XML_3.99-0.9 ## [101] jpeg_0.1-9 IRanges_2.28.0 gridExtra_2.3 shape_1.4.6 ## [105] compiler_4.1.2 KernSmooth_2.23-20 crayon_1.5.0 htmltools_0.5.2 ## [109] mgcv_1.8-39 pcaPP_1.9-74 Formula_1.2-4 tidyr_1.2.0 ## [113] geneplotter_1.72.0 libcoin_1.0-9 DBI_1.1.2 biglm_0.9-2.1 ## [117] MASS_7.3-55 Matrix_1.4-0 ade4_1.7-18 getopt_1.20.3 ## [121] car_3.0-12 permute_0.9-7 cli_3.2.0 parallel_4.1.2 ## [125] igraph_1.2.11 GenomicRanges_1.46.1 pkgconfig_2.0.3 coin_1.4-2 ## [129] foreign_0.8-82 foreach_1.5.2 annotate_1.72.0 bslib_0.3.1 ## [133] multtest_2.50.0 XVector_0.34.0 NADA_1.6-1.1 stringr_1.4.0 ## [137] digest_0.6.29 vegan_2.5-7 Biostrings_2.62.0 rmarkdown_2.13 ## [141] htmlTable_2.4.0 edgeR_3.36.0 gtools_3.9.2 modeltools_0.2-23 ## [145] lifecycle_1.0.1 nlme_3.1-155 jsonlite_1.8.0 Rhdf5lib_1.16.0 ## [149] carData_3.0-5 limma_3.50.1 fansi_1.0.2 pillar_1.7.0 ## [153] lattice_0.20-45 KEGGREST_1.34.0 fastmap_1.1.0 httr_1.4.2 ## [157] DEoptimR_1.0-10 survival_3.3-1 glue_1.6.2 png_0.1-7 ## [161] iterators_1.0.14 glmnet_4.1-3 bit_4.0.4 stringi_1.7.6 ## [165] sass_0.4.0 metagenomeSeq_1.36.0 blob_1.2.2 DESeq2_1.34.0 ## [169] latticeExtra_0.6-29 caTools_1.18.2 memoise_2.0.1 ape_5.6-2 "],["permanova-beta-dispersion-ordination.html", "Chapter 6 PERMANOVA + beta dispersion + Ordination 6.1 PERMANOVA 6.2 beta dispersion 6.3 Ordination 6.4 Systematic Information", " Chapter 6 PERMANOVA + beta dispersion + Ordination Loading packages library(XMAS) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) 6.1 PERMANOVA dada2_ps_per &lt;- run_permanova(ps=metaphlan2_ps_final, method = &quot;bray&quot;) print(dada2_ps_per) ## SumsOfSample Df SumsOfSqs MeanSqs F.Model R2 Pr(&gt;F) AdjustedPvalue ## SampleID 22 21 6.868829 0.3270871 0.000000 1.0000000 1.000 1.0000 ## Group 22 1 0.864659 0.8646590 2.880195 0.1258816 0.002 0.0060 ## phynotype 22 10 3.503431 0.3503431 1.145117 0.5100477 0.173 0.2595 The PERMANOVA result of the Group (AdjustedPvalue &gt; 0.05) revealed that the two groups had not the distinct patterns of microbial community. 6.2 beta dispersion beta_df &lt;- run_beta_diversity(ps=metaphlan2_ps_final, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.00725 0.0072500 0.8423 999 0.362 ## Residuals 20 0.17215 0.0086076 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## AA BB ## AA 0.37 ## BB 0.36968 6.3 Ordination We performed ordination by using Principal Coordinate Analysis (PCoA). If you want to try other methods please go to see Chapter 8 for more details. dada2_ps_ordination &lt;- run_ordination( ps = metaphlan2_ps_final, group = &quot;Group&quot;, method = &quot;PCoA&quot;) plot_Ordination(ResultList = dada2_ps_ordination, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), group_color = c(&quot;blue&quot;, &quot;red&quot;)) Figure 6.1: PCoA 6.4 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 DT_0.21 withr_2.5.0 colorspace_2.0-3 ## [13] Biobase_2.54.0 highr_0.9 knitr_1.37 rstudioapi_0.13 ## [17] pscl_1.5.5 stats4_4.1.2 robustbase_0.93-9 ggsignif_0.6.3 ## [21] MatrixGenerics_1.6.0 labeling_0.4.2 optparse_1.7.1 mbzinb_0.2 ## [25] GenomeInfoDbData_1.2.7 lpsymphony_1.22.0 pheatmap_1.0.12 bit64_4.0.5 ## [29] farver_2.1.0 rhdf5_2.38.1 vctrs_0.3.8 generics_0.1.2 ## [33] TH.data_1.1-0 xfun_0.30 Maaslin2_1.8.0 R6_2.5.1 ## [37] GenomeInfoDb_1.30.1 locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 ## [41] rhdf5filters_1.6.0 cachem_1.0.6 DelayedArray_0.20.0 assertthat_0.2.1 ## [45] scales_1.1.1 multcomp_1.4-18 nnet_7.3-17 gtable_0.3.0 ## [49] sandwich_3.0-1 rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 ## [53] protoclust_1.6.3 rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 ## [57] yaml_2.3.5 reshape2_1.4.4 abind_1.4-5 crosstalk_1.2.0 ## [61] backports_1.4.1 Rfast_2.0.6 qvalue_2.26.0 Hmisc_4.6-0 ## [65] DiagrammeR_1.0.9 tools_4.1.2 bookdown_0.24 zCompositions_1.4.0 ## [69] ellipsis_0.3.2 gplots_3.1.1 jquerylib_0.1.4 biomformat_1.22.0 ## [73] RColorBrewer_1.1-2 BiocGenerics_0.40.0 Rcpp_1.0.8.2 plyr_1.8.6 ## [77] base64enc_0.1-3 visNetwork_2.1.0 zlibbioc_1.40.0 purrr_0.3.4 ## [81] RCurl_1.98-1.6 rpart_4.1.16 Wrench_1.12.0 cowplot_1.1.1 ## [85] S4Vectors_0.32.3 zoo_1.8-9 SummarizedExperiment_1.24.0 ggrepel_0.9.1 ## [89] cluster_2.1.2 magrittr_2.0.2 data.table_1.14.2 truncnorm_1.0-8 ## [93] mvtnorm_1.1-3 matrixStats_0.61.0 ALDEx2_1.26.0 corncob_0.2.0 ## [97] RAIDA_1.0 evaluate_0.15 xtable_1.8-4 XML_3.99-0.9 ## [101] jpeg_0.1-9 IRanges_2.28.0 gridExtra_2.3 shape_1.4.6 ## [105] compiler_4.1.2 KernSmooth_2.23-20 crayon_1.5.0 htmltools_0.5.2 ## [109] mgcv_1.8-39 pcaPP_1.9-74 Formula_1.2-4 tidyr_1.2.0 ## [113] geneplotter_1.72.0 libcoin_1.0-9 DBI_1.1.2 biglm_0.9-2.1 ## [117] MASS_7.3-55 Matrix_1.4-0 ade4_1.7-18 getopt_1.20.3 ## [121] car_3.0-12 permute_0.9-7 cli_3.2.0 parallel_4.1.2 ## [125] igraph_1.2.11 GenomicRanges_1.46.1 pkgconfig_2.0.3 coin_1.4-2 ## [129] foreign_0.8-82 foreach_1.5.2 annotate_1.72.0 bslib_0.3.1 ## [133] multtest_2.50.0 XVector_0.34.0 NADA_1.6-1.1 stringr_1.4.0 ## [137] digest_0.6.29 vegan_2.5-7 Biostrings_2.62.0 rmarkdown_2.13 ## [141] htmlTable_2.4.0 edgeR_3.36.0 gtools_3.9.2 modeltools_0.2-23 ## [145] lifecycle_1.0.1 nlme_3.1-155 jsonlite_1.8.0 Rhdf5lib_1.16.0 ## [149] carData_3.0-5 limma_3.50.1 fansi_1.0.2 pillar_1.7.0 ## [153] lattice_0.20-45 KEGGREST_1.34.0 fastmap_1.1.0 httr_1.4.2 ## [157] DEoptimR_1.0-10 survival_3.3-1 glue_1.6.2 png_0.1-7 ## [161] iterators_1.0.14 glmnet_4.1-3 bit_4.0.4 stringi_1.7.6 ## [165] sass_0.4.0 metagenomeSeq_1.36.0 blob_1.2.2 DESeq2_1.34.0 ## [169] latticeExtra_0.6-29 caTools_1.18.2 memoise_2.0.1 ape_5.6-2 "],["microbial-composition.html", "Chapter 7 Microbial composition 7.1 Stacked barplot 7.2 Core microbiota 7.3 Systematic Information", " Chapter 7 Microbial composition Loading packages library(XMAS) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) A whole picture of the microbial composition. 7.1 Stacked barplot XMAS package plot_StackBarPlot( ps=metaphlan2_ps_final, taxa_level=&quot;Phylum&quot;, group = &quot;Group&quot;, cluster = TRUE) Figure 7.1: Microbial composition XVIZ package plot_stacked_bar( phyloseq = metaphlan2_ps_final, level = &quot;Phylum&quot;, feature = &quot;Group&quot;) Figure 7.2: Microbial composition in XVIZ 7.2 Core microbiota prevalences &lt;- seq(0.05, 1, 0.05) detections &lt;- 10^seq(log10(1e-3), log10(0.2), length = 10) pl_core &lt;- plot_core_taxa(metaphlan2_ps_final, plot.type = &quot;heatmap&quot;, colours = gray(seq(0, 1, length=5)), prevalences = prevalences, detections = detections, min.prevalence = 0.5)+ xlab(&quot;Detection Threshold (Relative Abundance (%))&quot;) pl_core Figure 7.3: Core taxa The degree of color indicates the size of abundance and prevalence. Use core_members to obtain the core taxa. detection for abundance and prevalence for occurrence. core_taxa_name &lt;- core_members(metaphlan2_ps_final, detection = 0.01, prevalence = 0.5) print(core_taxa_name) ## [1] &quot;s__Bacteroides_uniformis&quot; &quot;s__Bacteroides_vulgatus&quot; &quot;s__Faecalibacterium_prausnitzii&quot; ## [4] &quot;s__Ruminococcus_sp_5_1_39BFAA&quot; Result: Only 4 genera (s__Bacteroides_uniformis, s__Bacteroides_vulgatus, s__Faecalibacterium_prausnitzii and s__Ruminococcus_sp_5_1_39BFAA) passed the threshold of detection and prevalence which we choose. 7.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 DT_0.21 withr_2.5.0 colorspace_2.0-3 ## [13] Biobase_2.54.0 highr_0.9 knitr_1.37 rstudioapi_0.13 ## [17] pscl_1.5.5 stats4_4.1.2 robustbase_0.93-9 ggsignif_0.6.3 ## [21] MatrixGenerics_1.6.0 labeling_0.4.2 optparse_1.7.1 mbzinb_0.2 ## [25] GenomeInfoDbData_1.2.7 lpsymphony_1.22.0 pheatmap_1.0.12 bit64_4.0.5 ## [29] farver_2.1.0 rhdf5_2.38.1 vctrs_0.3.8 generics_0.1.2 ## [33] TH.data_1.1-0 xfun_0.30 Maaslin2_1.8.0 R6_2.5.1 ## [37] GenomeInfoDb_1.30.1 locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 ## [41] rhdf5filters_1.6.0 cachem_1.0.6 DelayedArray_0.20.0 assertthat_0.2.1 ## [45] scales_1.1.1 multcomp_1.4-18 nnet_7.3-17 gtable_0.3.0 ## [49] sandwich_3.0-1 rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 ## [53] protoclust_1.6.3 rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 ## [57] yaml_2.3.5 reshape2_1.4.4 abind_1.4-5 crosstalk_1.2.0 ## [61] backports_1.4.1 Rfast_2.0.6 qvalue_2.26.0 Hmisc_4.6-0 ## [65] DiagrammeR_1.0.9 tools_4.1.2 bookdown_0.24 zCompositions_1.4.0 ## [69] ellipsis_0.3.2 gplots_3.1.1 jquerylib_0.1.4 biomformat_1.22.0 ## [73] RColorBrewer_1.1-2 BiocGenerics_0.40.0 Rcpp_1.0.8.2 plyr_1.8.6 ## [77] base64enc_0.1-3 visNetwork_2.1.0 zlibbioc_1.40.0 purrr_0.3.4 ## [81] RCurl_1.98-1.6 rpart_4.1.16 Wrench_1.12.0 cowplot_1.1.1 ## [85] S4Vectors_0.32.3 zoo_1.8-9 SummarizedExperiment_1.24.0 ggrepel_0.9.1 ## [89] cluster_2.1.2 magrittr_2.0.2 data.table_1.14.2 truncnorm_1.0-8 ## [93] mvtnorm_1.1-3 matrixStats_0.61.0 ALDEx2_1.26.0 corncob_0.2.0 ## [97] RAIDA_1.0 evaluate_0.15 xtable_1.8-4 XML_3.99-0.9 ## [101] jpeg_0.1-9 IRanges_2.28.0 gridExtra_2.3 shape_1.4.6 ## [105] compiler_4.1.2 KernSmooth_2.23-20 crayon_1.5.0 htmltools_0.5.2 ## [109] mgcv_1.8-39 pcaPP_1.9-74 Formula_1.2-4 tidyr_1.2.0 ## [113] geneplotter_1.72.0 libcoin_1.0-9 DBI_1.1.2 biglm_0.9-2.1 ## [117] MASS_7.3-55 Matrix_1.4-0 ade4_1.7-18 getopt_1.20.3 ## [121] car_3.0-12 permute_0.9-7 cli_3.2.0 parallel_4.1.2 ## [125] igraph_1.2.11 GenomicRanges_1.46.1 pkgconfig_2.0.3 coin_1.4-2 ## [129] foreign_0.8-82 foreach_1.5.2 annotate_1.72.0 bslib_0.3.1 ## [133] multtest_2.50.0 XVector_0.34.0 NADA_1.6-1.1 stringr_1.4.0 ## [137] digest_0.6.29 vegan_2.5-7 Biostrings_2.62.0 rmarkdown_2.13 ## [141] htmlTable_2.4.0 edgeR_3.36.0 gtools_3.9.2 modeltools_0.2-23 ## [145] lifecycle_1.0.1 nlme_3.1-155 jsonlite_1.8.0 Rhdf5lib_1.16.0 ## [149] carData_3.0-5 limma_3.50.1 fansi_1.0.2 pillar_1.7.0 ## [153] lattice_0.20-45 KEGGREST_1.34.0 fastmap_1.1.0 httr_1.4.2 ## [157] DEoptimR_1.0-10 survival_3.3-1 glue_1.6.2 png_0.1-7 ## [161] iterators_1.0.14 glmnet_4.1-3 bit_4.0.4 stringi_1.7.6 ## [165] sass_0.4.0 metagenomeSeq_1.36.0 blob_1.2.2 DESeq2_1.34.0 ## [169] latticeExtra_0.6-29 caTools_1.18.2 memoise_2.0.1 ape_5.6-2 "],["differential-analysis.html", "Chapter 8 Differential Analysis 8.1 Liner discriminant analysis (LDA) effect size (LEfSe) 8.2 Wilcoxon Rank-Sum test 8.3 Dominant taxa 8.4 Multiple differential analysis by one function 8.5 Systematic Information", " Chapter 8 Differential Analysis Loading packages library(XMAS) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) There are more than 10 approaches to perform differential analysis. Here, we choose two of them and recommend users going to Chapter 10 to see more detials. 8.1 Liner discriminant analysis (LDA) effect size (LEfSe) Calculation metaphlan2_ps_lefse &lt;- run_lefse( metaphlan2_ps_final, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), transform = &quot;identity&quot;, norm = &quot;none&quot;, wl.p = 0.05, Lda = 0) head(metaphlan2_ps_lefse) ## TaxaID Block Enrichment LDA_Score EffectSize Log2FoldChange (Median)\\nAA_vs_BB ## 1 s__Bacteroides_thetaiotaomicron 7_AA vs 15_BB AA -0.0103249698 1.9418180 5.505858 ## 2 s__Dorea_longicatena 7_AA vs 15_BB BB 0.0001704455 1.7435380 NA ## 3 s__Clostridium_bartlettii 7_AA vs 15_BB BB 0.0004552621 0.5784397 NA ## 4 s__Eubacterium_hallii 7_AA vs 15_BB BB 0.0016959113 0.7995960 NA ## 5 s__Megamonas_rupellensis 7_AA vs 15_BB BB 0.0021444361 0.5938727 NA ## 6 s__Collinsella_aerofaciens 7_AA vs 15_BB BB 0.0025432767 0.9034469 NA ## Median Abundance\\n(All) Median Abundance\\nAA Median Abundance\\nBB Log2FoldChange (Mean)\\nAA_vs_BB ## 1 0.00247415 0.0453799 0.0009987 3.327766 ## 2 0.00078795 0.0000000 0.0081496 -7.307095 ## 3 0.00025355 0.0000000 0.0004470 -3.821895 ## 4 0.00436885 0.0000000 0.0109294 -3.781465 ## 5 0.00000000 0.0005600 0.0000000 5.020069 ## 6 0.00738145 0.0000000 0.0112480 -3.336571 ## Mean Abundance\\n(All) Mean Abundance\\nAA Mean Abundance\\nBB Occurrence (100%)\\n(All) Occurrence (100%)\\nAA ## 1 0.0219183273 5.677024e-02 5.654100e-03 90.91 100.00 ## 2 0.0065455500 6.044286e-05 9.571933e-03 63.64 42.86 ## 3 0.0012202818 1.225143e-04 1.732573e-03 68.18 42.86 ## 4 0.0087429000 9.019000e-04 1.240203e-02 63.64 42.86 ## 5 0.0008989182 2.650157e-03 8.167333e-05 31.82 57.14 ## 6 0.0118099818 1.638929e-03 1.655647e-02 63.64 42.86 ## Occurrence (100%)\\nBB Odds Ratio (95% CI) ## 1 86.67 0.038 (-6.4;6.4) ## 2 73.33 8.9e+12 (8.9e+12;8.9e+12) ## 3 80.00 600 (610;580) ## 4 73.33 110 (120;100) ## 5 20.00 0.0055 (-10;10) ## 6 73.33 41 (48;34) Visualization # in order to show barplot (don&#39;t run it in reality) metaphlan2_ps_lefse$LDA_Score &lt;- metaphlan2_ps_lefse$LDA_Score * 1000 plot_lefse( da_res = metaphlan2_ps_lefse, x_index = &quot;LDA_Score&quot;, x_index_cutoff = 2, group_color = c(&quot;green&quot;, &quot;red&quot;)) Figure 8.1: Lefse analysis 8.2 Wilcoxon Rank-Sum test Calculation metaphlan2_ps_wilcox &lt;- run_wilcox( metaphlan2_ps_final, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), transform = &quot;identity&quot;, norm = &quot;none&quot;, p_adjust = &quot;BH&quot;, pvalue_cutoff = 0.05) head(metaphlan2_ps_wilcox) ## TaxaID Block Enrichment EffectSize Statistic Pvalue AdjustedPvalue ## 1 s__Alistipes_finegoldii 7_AA vs 15_BB Nonsignif 1.23094855 73.5 0.1145448 0.4521504 ## 2 s__Alistipes_indistinctus 7_AA vs 15_BB Nonsignif 0.78954179 66.0 0.2677815 0.6616137 ## 3 s__Alistipes_onderdonkii 7_AA vs 15_BB Nonsignif 1.14756258 63.5 0.4370143 0.7578592 ## 4 s__Alistipes_putredinis 7_AA vs 15_BB Nonsignif 1.34298152 54.0 0.9409918 0.9830621 ## 5 s__Alistipes_shahii 7_AA vs 15_BB Nonsignif 1.04736939 71.0 0.1751506 0.5801989 ## 6 s__Anaerostipes_hadrus 7_AA vs 15_BB Nonsignif 0.02734989 30.5 0.1258306 0.4625882 ## Log2FoldChange (Median)\\nAA_vs_BB Median Abundance\\n(All) Median Abundance\\nAA Median Abundance\\nBB ## 1 NA 0.00000000 0.0027362 0.0000000 ## 2 NA 0.00000000 0.0000000 0.0000000 ## 3 5.819157 0.00000825 0.0002823 0.0000050 ## 4 NA 0.00016915 0.0000000 0.0002200 ## 5 NA 0.00012580 0.0062474 0.0000000 ## 6 -3.900867 0.00013665 0.0000144 0.0002151 ## Log2FoldChange (Rank)\\nAA_vs_BB Mean Rank Abundance\\nAA Mean Rank Abundance\\nBB Occurrence (100%)\\n(All) ## 1 0.52169761 14.50 10.10 45.45 ## 2 0.34139504 13.43 10.60 31.82 ## 3 0.27924089 13.07 10.77 54.55 ## 4 0.03870725 11.71 11.40 54.55 ## 5 0.46134594 14.14 10.27 50.00 ## 6 -0.63360363 8.36 12.97 72.73 ## Occurrence (100%)\\nAA Occurrence (100%)\\nBB Odds Ratio (95% CI) ## 1 57.14 40.00 0.0028 (-12;12) ## 2 42.86 26.67 0.067 (-5.2;5.4) ## 3 57.14 53.33 0.38 (-1.5;2.3) ## 4 42.86 60.00 0.47 (-0.99;1.9) ## 5 57.14 46.67 0.17 (-3.2;3.6) ## 6 57.14 80.00 31 (38;24) Volcano plot_volcano( metaphlan2_ps_wilcox, group_names = c(&quot;AA&quot;, &quot;BB&quot;), x_index = &quot;Log2FoldChange (Rank)\\nAA_vs_BB&quot;, x_index_cutoff = 0.5, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.05, group_color = c(&quot;red&quot;, &quot;grey&quot;, &quot;blue&quot;), topN = 5) Figure 8.2: Wilcoxon Rank-Sum test 8.3 Dominant taxa Display the significant taxa with selection using boxplot. DA_wilcox &lt;- run_wilcox( metaphlan2_ps_final, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), transform = &quot;identity&quot;, norm = &quot;none&quot;, p_adjust = &quot;BH&quot;, pvalue_cutoff = 0.05) plot_topN_boxplot( ps = metaphlan2_ps_final, da_res = DA_wilcox, x_index = &quot;Log2FoldChange (Median)\\nAA_vs_BB&quot;, x_index_cutoff = 0.2, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.3, prevalence = TRUE, topN = 3, group = &quot;Group&quot;) Figure 8.3: Dominant Taxa 8.4 Multiple differential analysis by one function here, we provide the run_multiple_da for obtaining the results list from multiple differential analysis methods. multiple_res &lt;- run_multiple_da( metaphlan2_ps_final, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), da_method = c(&quot;wilcox&quot;, &quot;limma_voom&quot;, &quot;ttest&quot;), norm = &quot;none&quot;, transform = &quot;identity&quot;, p_adjust = &quot;none&quot;, pvalue_cutoff = 0.05) names(multiple_res) ## [1] &quot;wilcox&quot; &quot;limma_voom&quot; &quot;ttest&quot; plot results plot_multiple_DA( Multip_DA_res = multiple_res, y_index = &quot;AdjustedPvalue&quot;, y_index_cutoff = 0.5, cellwidth = 35, cellheight = 10, fontsize_number = 15) Figure 8.4: Multiple DA results 8.5 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggpubr_0.4.0 ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 XMAS_2.1.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 ## [5] htmlwidgets_1.5.4 grid_4.1.2 BiocParallel_1.28.3 munsell_0.5.0 ## [9] codetools_0.2-18 DT_0.21 withr_2.5.0 colorspace_2.0-3 ## [13] Biobase_2.54.0 highr_0.9 knitr_1.37 rstudioapi_0.13 ## [17] pscl_1.5.5 stats4_4.1.2 bayesm_3.1-4 robustbase_0.93-9 ## [21] ggsignif_0.6.3 MatrixGenerics_1.6.0 labeling_0.4.2 optparse_1.7.1 ## [25] mbzinb_0.2 GenomeInfoDbData_1.2.7 lpsymphony_1.22.0 pheatmap_1.0.12 ## [29] bit64_4.0.5 farver_2.1.0 rhdf5_2.38.1 vctrs_0.3.8 ## [33] generics_0.1.2 TH.data_1.1-0 xfun_0.30 Maaslin2_1.8.0 ## [37] R6_2.5.1 GenomeInfoDb_1.30.1 locfit_1.5-9.5 RcppZiggurat_0.1.6 ## [41] bitops_1.0-7 rhdf5filters_1.6.0 cachem_1.0.6 DelayedArray_0.20.0 ## [45] assertthat_0.2.1 scales_1.1.1 multcomp_1.4-18 nnet_7.3-17 ## [49] gtable_0.3.0 sandwich_3.0-1 rlang_1.0.2 genefilter_1.76.0 ## [53] splines_4.1.2 protoclust_1.6.3 rstatix_0.7.0 broom_0.7.12 ## [57] checkmate_2.0.0 yaml_2.3.5 reshape2_1.4.4 abind_1.4-5 ## [61] crosstalk_1.2.0 backports_1.4.1 Rfast_2.0.6 qvalue_2.26.0 ## [65] Hmisc_4.6-0 DiagrammeR_1.0.9 tensorA_0.36.2 tools_4.1.2 ## [69] bookdown_0.24 zCompositions_1.4.0 ellipsis_0.3.2 gplots_3.1.1 ## [73] jquerylib_0.1.4 biomformat_1.22.0 RColorBrewer_1.1-2 BiocGenerics_0.40.0 ## [77] Rcpp_1.0.8.2 plyr_1.8.6 base64enc_0.1-3 visNetwork_2.1.0 ## [81] zlibbioc_1.40.0 purrr_0.3.4 RCurl_1.98-1.6 rpart_4.1.16 ## [85] Wrench_1.12.0 cowplot_1.1.1 S4Vectors_0.32.3 zoo_1.8-9 ## [89] SummarizedExperiment_1.24.0 ggrepel_0.9.1 cluster_2.1.2 magrittr_2.0.2 ## [93] data.table_1.14.2 truncnorm_1.0-8 mvtnorm_1.1-3 matrixStats_0.61.0 ## [97] ALDEx2_1.26.0 corncob_0.2.0 RAIDA_1.0 evaluate_0.15 ## [101] xtable_1.8-4 XML_3.99-0.9 jpeg_0.1-9 IRanges_2.28.0 ## [105] gridExtra_2.3 shape_1.4.6 compiler_4.1.2 KernSmooth_2.23-20 ## [109] crayon_1.5.0 htmltools_0.5.2 mgcv_1.8-39 pcaPP_1.9-74 ## [113] Formula_1.2-4 tidyr_1.2.0 geneplotter_1.72.0 libcoin_1.0-9 ## [117] DBI_1.1.2 biglm_0.9-2.1 MASS_7.3-55 compositions_2.0-4 ## [121] Matrix_1.4-0 ade4_1.7-18 getopt_1.20.3 car_3.0-12 ## [125] permute_0.9-7 cli_3.2.0 parallel_4.1.2 igraph_1.2.11 ## [129] GenomicRanges_1.46.1 pkgconfig_2.0.3 coin_1.4-2 foreign_0.8-82 ## [133] foreach_1.5.2 annotate_1.72.0 bslib_0.3.1 multtest_2.50.0 ## [137] XVector_0.34.0 NADA_1.6-1.1 stringr_1.4.0 digest_0.6.29 ## [141] vegan_2.5-7 Biostrings_2.62.0 rmarkdown_2.13 htmlTable_2.4.0 ## [145] edgeR_3.36.0 gtools_3.9.2 modeltools_0.2-23 lifecycle_1.0.1 ## [149] nlme_3.1-155 jsonlite_1.8.0 Rhdf5lib_1.16.0 carData_3.0-5 ## [153] limma_3.50.1 fansi_1.0.2 pillar_1.7.0 lattice_0.20-45 ## [157] KEGGREST_1.34.0 fastmap_1.1.0 httr_1.4.2 DEoptimR_1.0-10 ## [161] survival_3.3-1 glue_1.6.2 png_0.1-7 iterators_1.0.14 ## [165] glmnet_4.1-3 bit_4.0.4 stringi_1.7.6 sass_0.4.0 ## [169] metagenomeSeq_1.36.0 blob_1.2.2 DESeq2_1.34.0 latticeExtra_0.6-29 ## [173] caTools_1.18.2 memoise_2.0.1 ape_5.6-2 "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
