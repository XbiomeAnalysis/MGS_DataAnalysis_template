[["index.html", "MGS microbiota data analysis based on XMAS package Chapter 1 Prerequisites 1.1 Preparing for the tutorial 1.2 Workflow description", " MGS microbiota data analysis based on XMAS package Hua Zou 2022-06-01 Chapter 1 Prerequisites Here, we give users one example to practice the MGS microbiota data analysis workflow by XMAS 2.0. By the way, we also recommend users handling your own microbiota data in a reasonable manner when you utilize this package or workflow. Pay attention to whether your data fit the methods this package provided. 1.1 Preparing for the tutorial This tutorial requires that the users should have basic knowledge on R language and statistics. If you are new to microbial research, we recommend the Statistical Analysis of Microbiome Data with R (Xia et al. 2018) as guide book. We suggest users using local laptop because our own server have not deployed XMAS 2.0 package yet. In addition, installing the following software before using XMAS 2.0. R 3.6.3 or later release Download link. Rstudio Desktop Download link. 1.2 Workflow description The standard data analysis of 16S and MGS data by XMAS 2.0. The upstream process is performed by in-house pipeline. and this example just shows how to perform downstream data analysis. In briefly, the example comprises the following steps: Converting inputs into phyloseq object; Quality Evaluation; Pre-Processing Data; Diversity analysis; Ordination analysis; Composition analysis; Differential analysis. Figure 1.1: Functions of XMAS 2.0 References "],["convert-inputdata-into-phyloseq-object.html", "Chapter 2 Convert inputdata into phyloseq object 2.1 Metaphlan2/3 2.2 Transform the abundance of taxa whose relative abundance under Limit Of Detection (LOD) into Zeros 2.3 Systematic Information", " Chapter 2 Convert inputdata into phyloseq object r Biocpkg(“phyloseq”) (McMurdie and Holmes 2013) is the most popular Biocondcutor package used by the microbiome research field, and phyloseq-class objects are a great data-standard for microbiota data in R. Therefore, the core functions in XMAS take phyloseq-class object as input. In the phyloseq object, information on OTU abundances, taxonomy of OTUs, the phylogenetic tree and metadata is stored. This tutorial will introduce you the basic steps to convert results from the in-house pipeline into phyloseq-class object. More importantly on how to look at your data and filter appropriately. We will use the inputs from /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/. Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) 2.1 Metaphlan2/3 The result of the in-house Metaphlan2/3 pipeline. 2.1.1 Importing results /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/MGS/metaphlan2_merged.tsv /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/MGS/metadata.txt metaphlan2_res &lt;- read.table( system.file( &quot;extdata&quot;, &quot;metaphlan2_merged.tsv&quot;, package = &quot;XMAS2&quot; ), header = TRUE, stringsAsFactors = FALSE ) metaphlan2_sam &lt;- read.table( system.file( &quot;extdata&quot;, &quot;metaphlan2_metadata.tsv&quot;, package = &quot;XMAS2&quot; ), sep = &quot;\\t&quot;, header = TRUE, stringsAsFactors = FALSE ) 2.1.2 taxa table metaphlan2_res_list &lt;- import_metaphlan_taxa(metaphlan2_res, taxa_level = &quot;Species&quot;) tax_tab &lt;- metaphlan2_res_list$tax_tab head(tax_tab) ## Kingdom Phylum Class Order Family Genus ## s__Actinomyces_graevenitzii k__Bacteria p__Actinobacteria c__Actinobacteria o__Actinomycetales f__Actinomycetaceae g__Actinomyces ## s__Actinomyces_johnsonii k__Bacteria p__Actinobacteria c__Actinobacteria o__Actinomycetales f__Actinomycetaceae g__Actinomyces ## s__Actinomyces_massiliensis k__Bacteria p__Actinobacteria c__Actinobacteria o__Actinomycetales f__Actinomycetaceae g__Actinomyces ## s__Actinomyces_odontolyticus k__Bacteria p__Actinobacteria c__Actinobacteria o__Actinomycetales f__Actinomycetaceae g__Actinomyces ## s__Actinomyces_oris k__Bacteria p__Actinobacteria c__Actinobacteria o__Actinomycetales f__Actinomycetaceae g__Actinomyces ## s__Actinomyces_viscosus k__Bacteria p__Actinobacteria c__Actinobacteria o__Actinomycetales f__Actinomycetaceae g__Actinomyces ## Species ## s__Actinomyces_graevenitzii s__Actinomyces_graevenitzii ## s__Actinomyces_johnsonii s__Actinomyces_johnsonii ## s__Actinomyces_massiliensis s__Actinomyces_massiliensis ## s__Actinomyces_odontolyticus s__Actinomyces_odontolyticus ## s__Actinomyces_oris s__Actinomyces_oris ## s__Actinomyces_viscosus s__Actinomyces_viscosus 2.1.3 otu table metaphlan2_res_list &lt;- import_metaphlan_taxa(metaphlan2_res, taxa_level = &quot;Species&quot;) otu_tab &lt;- metaphlan2_res_list$abu_tab head(otu_tab) ## s1 s2 s3 s4 s5 s6 s7 s8 s9 s10 s11 s12 s13 s14 s15 s16 s17 ## s__Actinomyces_graevenitzii 3.58e-05 0 0.0e+00 0 0 0 7.20e-06 0.0e+00 0.0000000 0 1.40e-05 0e+00 0.00e+00 0.0e+00 0 0 0 ## s__Actinomyces_johnsonii 0.00e+00 0 0.0e+00 0 0 0 0.00e+00 0.0e+00 0.0000000 0 0.00e+00 0e+00 1.15e-05 0.0e+00 0 0 0 ## s__Actinomyces_massiliensis 0.00e+00 0 0.0e+00 0 0 0 2.95e-05 0.0e+00 0.0000000 0 0.00e+00 0e+00 0.00e+00 0.0e+00 0 0 0 ## s__Actinomyces_odontolyticus 7.70e-05 0 1.7e-06 0 0 0 2.47e-05 5.8e-06 0.0001175 0 6.16e-05 0e+00 1.66e-05 3.9e-06 0 0 0 ## s__Actinomyces_oris 0.00e+00 0 0.0e+00 0 0 0 2.81e-05 0.0e+00 0.0000135 0 0.00e+00 0e+00 0.00e+00 0.0e+00 0 0 0 ## s__Actinomyces_viscosus 4.60e-06 0 0.0e+00 0 0 0 0.00e+00 0.0e+00 0.0000039 0 6.20e-06 7e-06 1.10e-06 0.0e+00 0 0 0 ## s18 s19 s20 s21 s22 refE ## s__Actinomyces_graevenitzii 6.1e-06 1.60e-06 0 0 0.00e+00 0 ## s__Actinomyces_johnsonii 0.0e+00 0.00e+00 0 0 0.00e+00 0 ## s__Actinomyces_massiliensis 0.0e+00 0.00e+00 0 0 2.52e-05 0 ## s__Actinomyces_odontolyticus 0.0e+00 4.19e-05 0 0 0.00e+00 0 ## s__Actinomyces_oris 0.0e+00 0.00e+00 0 0 7.40e-06 0 ## s__Actinomyces_viscosus 0.0e+00 0.00e+00 0 0 7.28e-05 0 2.1.4 metadata table sam_tab &lt;- metaphlan2_sam %&gt;% tibble::column_to_rownames(&quot;SampleID&quot;) head(sam_tab) ## Group phynotype ## s1 BB 0.00 ## s2 AA 2.50 ## s3 BB 0.00 ## s4 AA 1.25 ## s5 AA 30.00 ## s6 AA 15.00 2.1.5 phyloseq object metaphlan2_ps &lt;- get_metaphlan_phyloseq(otu_tab = otu_tab, sam_tab = sam_tab, tax_tab = tax_tab) metaphlan2_ps ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 326 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 326 taxa by 7 taxonomic ranks ] we obtain the phyloseq-class object and then use it to perform data analysis. Here, the phyloseq object comprises five components (OTU Table, Sample Data, and Taxonomy Table). 2.2 Transform the abundance of taxa whose relative abundance under Limit Of Detection (LOD) into Zeros metaphlan2_ps_Species_LOD &lt;- aggregate_LOD_taxa(metaphlan2_ps, taxa_level = &quot;Species&quot;, cutoff = 1e-04) metaphlan2_ps_Species_LOD ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 192 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 192 taxa by 7 taxonomic ranks ] 2.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 RcppZiggurat_0.1.6 ## [41] Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 scales_1.1.1 ## [46] pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 rstatix_0.7.0 ## [51] xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 truncnorm_1.0-8 ## [56] glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 RColorBrewer_1.1-2 ## [61] modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 pkgconfig_2.0.3 XML_3.99-0.9 ## [66] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [71] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [76] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [81] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [86] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [91] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [96] coin_1.4-2 nlme_3.1-155 mbzinb_0.2 compiler_4.1.2 rstudioapi_0.13 ## [101] png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 geneplotter_1.72.0 bslib_0.3.1 ## [106] stringi_1.7.6 highr_0.9 lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 ## [111] permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 ## [116] rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 ## [121] latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 ## [126] codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 ## [131] rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 ## [136] mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 tidyr_1.2.0 Rfast_2.0.6 ## [141] rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 lubridate_1.8.0 base64enc_0.1-3 References "],["quality-control.html", "Chapter 3 Quality Control 3.1 spike-in sample (BRS) 3.2 Spike-in sample’s (BRS) remove 3.3 Systematic Information", " Chapter 3 Quality Control Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) The taxonomic levels of spike-in sample’s bacteria is species. Firstly, using the summarize_taxa to get the genus level phyloseq object and then do run_RefCheck under the optimal parameters. 3.1 spike-in sample (BRS) get the BRS_ID metaphlan2_ps_Species_LOD@sam_data ## Group phynotype ## s1 BB 0.00 ## s2 AA 2.50 ## s3 BB 0.00 ## s4 AA 1.25 ## s5 AA 30.00 ## s6 AA 15.00 ## s7 BB 8.75 ## s8 BB 0.00 ## s9 BB 3.75 ## s10 BB 2.50 ## s11 BB 15.00 ## s12 BB 2.50 ## s13 BB 2.50 ## s14 BB 0.00 ## s15 BB 1.07 ## s16 BB 2.50 ## s17 AA 5.00 ## s18 BB 35.00 ## s19 BB 7.50 ## s20 BB 15.00 ## s21 AA 3.75 ## s22 AA 3.75 ## refE QC NA run run_RefCheck run_RefCheck( ps=metaphlan2_ps_Species_LOD, BRS_ID=&quot;refE&quot;, Reference=NULL, Ref_type=&quot;MGS&quot;, Save=NULL) ## 7682 7683 7684 7685 7842 7843 7844 7845 refE mean ## Bifidobacterium_longum 10.31563 9.25812 9.69184 7.76031 11.03311 11.61484 12.29030 11.69019 0.01646 9.29675556 ## Bacteroides_uniformis 2.24195 2.24035 1.92015 2.18435 2.43230 2.38180 2.13830 2.41437 0.21061 2.01824222 ## Faecalibacterium_prausnitzii 0.65615 0.60153 0.60112 0.62079 0.54147 0.55383 0.58806 0.54655 1.61939 0.70321000 ## Bifidobacterium_adolescentis 7.05426 6.28460 6.57297 6.25448 4.69357 4.80628 4.94943 4.84278 0.04649 5.05609556 ## Bacteroides_thetaiotaomicron 3.25076 3.31897 3.22418 3.43809 3.35611 3.38323 3.29098 3.30355 1.47422 3.11556556 ## Collinsella_aerofaciens 0.56220 0.53249 0.60476 0.47934 0.65513 0.68833 0.76063 0.66896 0.07251 0.55826111 ## Coprococcus_comes 2.28581 2.42978 2.25227 2.82904 1.21527 1.16485 1.07160 1.07834 0.01444 1.59348889 ## Dorea_formicigenerans 4.83509 5.02149 5.18268 5.56891 3.34720 3.09877 3.08677 2.70732 0.02775 3.65288667 ## Streptococcus_salivarius 3.54266 3.74119 3.62036 4.01546 2.90216 2.70193 2.61760 2.57348 0.02846 2.86036667 ## Bacteroides_xylanisolvens 1.55648 1.84824 1.91166 1.85273 1.75220 1.74002 1.69811 1.67676 0.32466 1.59565111 ## Bacteroides_ovatus 3.08489 3.27226 3.10904 3.24565 3.51376 3.50063 3.37872 3.42300 0.25782 2.97619667 ## Roseburia_hominis 0.04383 0.04183 0.04107 0.02304 0.03853 0.03464 0.03532 0.03597 0.01307 0.03414444 ## Bacteroides_vulgatus 3.06713 3.20369 3.14979 3.15352 3.24822 3.09280 3.13038 3.06113 2.14684 3.02816667 ## Prevotella_copri 2.03128 1.99619 1.92504 2.15422 1.57638 1.60584 1.57913 1.59224 60.84109 8.36682333 ## Bifidobacterium_pseudocatenulatum 6.89310 6.36177 7.39605 5.76804 6.19464 6.47094 7.41615 6.27837 0.15023 5.88103222 ## Lachnospiraceae_bacterium_5_1_63FAA 0.22002 0.26062 0.28058 0.33329 0.07093 0.06778 0.05229 0.04781 0.06825 0.15573000 ## Impurity_level 7.33876 7.34799 7.14891 6.47250 8.88190 9.72198 9.72162 10.57600 32.69000 11.09996222 ## Evaluation ## Bifidobacterium_longum refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Bacteroides_uniformis refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Faecalibacterium_prausnitzii refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Bifidobacterium_adolescentis refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Bacteroides_thetaiotaomicron refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Collinsella_aerofaciens refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Coprococcus_comes refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Dorea_formicigenerans refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Streptococcus_salivarius refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Bacteroides_xylanisolvens refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Bacteroides_ovatus refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Roseburia_hominis refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Bacteroides_vulgatus refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Prevotella_copri refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Bifidobacterium_pseudocatenulatum refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Lachnospiraceae_bacterium_5_1_63FAA refE didn&#39;t pass the threshold (2022-06-01 18:37:42). ## Impurity_level refE didn&#39;t pass the threshold (2022-06-01 18:37:42). 3.2 Spike-in sample’s (BRS) remove metaphlan2_ps_Species_LOD_remove_BRS &lt;- get_GroupPhyloseq( ps = metaphlan2_ps_Species_LOD, group = &quot;Group&quot;, group_names = &quot;QC&quot;) metaphlan2_ps_Species_LOD_remove_BRS ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 192 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 192 taxa by 7 taxonomic ranks ] 3.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 RcppZiggurat_0.1.6 ## [41] Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 scales_1.1.1 ## [46] pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 rstatix_0.7.0 ## [51] xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 truncnorm_1.0-8 ## [56] glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 RColorBrewer_1.1-2 ## [61] modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 pkgconfig_2.0.3 XML_3.99-0.9 ## [66] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [71] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [76] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [81] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [86] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [91] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [96] coin_1.4-2 nlme_3.1-155 mbzinb_0.2 compiler_4.1.2 rstudioapi_0.13 ## [101] png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 geneplotter_1.72.0 bslib_0.3.1 ## [106] stringi_1.7.6 highr_0.9 lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 ## [111] permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 ## [116] rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 ## [121] latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 ## [126] codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 ## [131] rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 ## [136] mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 tidyr_1.2.0 Rfast_2.0.6 ## [141] rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 lubridate_1.8.0 base64enc_0.1-3 "],["data-processing.html", "Chapter 4 Data processing 4.1 Extracting specific taxonomic level 4.2 Systematic Information", " Chapter 4 Data processing Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) This part has too may procedures and we only choose some of them. Please go to XMAS tutorial: Chapter 6 to see more approaches and details for being familiar with this part. 4.1 Extracting specific taxonomic level metaphlan2_ps_species &lt;- summarize_taxa(metaphlan2_ps_Species_LOD_remove_BRS, taxa_level = &quot;Species&quot;) metaphlan2_ps_species ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 192 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 192 taxa by 7 taxonomic ranks ] Finally, we obtained the final phyloseq-class object metaphlan2_ps_species. 4.2 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 RcppZiggurat_0.1.6 ## [41] Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 scales_1.1.1 ## [46] pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 rstatix_0.7.0 ## [51] xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 truncnorm_1.0-8 ## [56] glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 RColorBrewer_1.1-2 ## [61] modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 pkgconfig_2.0.3 XML_3.99-0.9 ## [66] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [71] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [76] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [81] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [86] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [91] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [96] coin_1.4-2 nlme_3.1-155 mbzinb_0.2 compiler_4.1.2 rstudioapi_0.13 ## [101] png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 geneplotter_1.72.0 bslib_0.3.1 ## [106] stringi_1.7.6 highr_0.9 lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 ## [111] permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 ## [116] rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 ## [121] latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 ## [126] codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 ## [131] rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 ## [136] mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 tidyr_1.2.0 Rfast_2.0.6 ## [141] rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 lubridate_1.8.0 base64enc_0.1-3 "],["diversity-analysis.html", "Chapter 5 Diversity analysis 5.1 Alpha diveristy 5.2 Beta diversity 5.3 Systematic Information", " Chapter 5 Diversity analysis Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) 5.1 Alpha diveristy Calculate the alpha diversity Notes: choosing the measures (Shannon, Simpson and InvSimpson) only for relative abundance. metaphlan2_ps_species_alpha &lt;- run_alpha_diversity(ps=metaphlan2_ps_species, measures = c(&quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot;)) DT::datatable(metaphlan2_ps_species_alpha) visualization plot_boxplot(data=metaphlan2_ps_species_alpha, y_index = c(&quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot;), group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), group_color = c(&quot;red&quot;, &quot;blue&quot;), do_test = TRUE, method = &quot;wilcox.test&quot;) Figure 5.1: Alpha diversity 5.2 Beta diversity beta dipersion metaphlan2_ps_beta &lt;- run_beta_diversity(ps=metaphlan2_ps_species, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.003278 0.0032783 0.4857 999 0.494 ## Residuals 20 0.134994 0.0067497 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## AA BB ## AA 0.498 ## BB 0.49388 metaphlan2_ps_beta$BetaDispersion Figure 5.2: Beta diversity 5.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 crosstalk_1.2.0 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 ## [11] foreach_1.5.2 htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 ## [16] cluster_2.1.2 limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 ## [21] metagenomeSeq_1.36.0 jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 ## [26] xfun_0.30 crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 ## [31] genefilter_1.76.0 survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 ## [36] gtable_0.3.0 zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 ## [41] RcppZiggurat_0.1.6 Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 ## [46] scales_1.1.1 pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 ## [51] rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 ## [56] DT_0.21 truncnorm_1.0-8 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 ## [61] gplots_3.1.1 RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 ## [66] pkgconfig_2.0.3 XML_3.99-0.9 farver_2.1.0 nnet_7.3-17 sass_0.4.0 ## [71] locfit_1.5-9.5 utf8_1.2.2 tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 ## [76] reshape2_1.4.4 AnnotationDbi_1.56.2 munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 ## [81] cachem_1.0.6 cli_3.2.0 generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 ## [86] broom_0.7.12 evaluate_0.15 biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 ## [91] yaml_2.3.5 knitr_1.37 bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 ## [96] purrr_0.3.4 KEGGREST_1.34.0 coin_1.4-2 nlme_3.1-155 mbzinb_0.2 ## [101] compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 ## [106] geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 lattice_0.20-45 ## [111] Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 ## [116] pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 ## [121] cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 ## [126] gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 ## [131] assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 ## [136] multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 ## [141] tidyr_1.2.0 Rfast_2.0.6 rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 ## [146] lubridate_1.8.0 base64enc_0.1-3 "],["permanova-beta-dispersion-ordination.html", "Chapter 6 PERMANOVA + beta dispersion + Ordination 6.1 PERMANOVA 6.2 beta dispersion 6.3 Ordination 6.4 Systematic Information", " Chapter 6 PERMANOVA + beta dispersion + Ordination Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) 6.1 PERMANOVA metaphlan2_ps_per &lt;- run_permanova(ps=metaphlan2_ps_species, method = &quot;bray&quot;, columns = &quot;Group&quot;) print(metaphlan2_ps_per) ## SumsOfSample Df SumsOfSqs MeanSqs F.Model R2 Pr(&gt;F) AdjustedPvalue ## Group 22 1 0.7940713 0.7940713 2.562609 0.1135777 0.002 0.002 The PERMANOVA result of the Group (AdjustedPvalue &gt; 0.05) revealed that the two groups had not the distinct patterns of microbial community. 6.2 beta dispersion beta_df &lt;- run_beta_diversity(ps=metaphlan2_ps_species, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.003278 0.0032783 0.4857 999 0.494 ## Residuals 20 0.134994 0.0067497 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## AA BB ## AA 0.498 ## BB 0.49388 6.3 Ordination We performed ordination by using Principal Coordinate Analysis (PCoA). metaphlan2_ps_ordination &lt;- run_ordination( ps = metaphlan2_ps_species, group = &quot;Group&quot;, method = &quot;PCoA&quot;) # plot_Ordination(ResultList = metaphlan2_ps_ordination, # group = &quot;Group&quot;, # group_names = c(&quot;AA&quot;, &quot;BB&quot;), # group_color = c(&quot;blue&quot;, &quot;red&quot;), # circle_type = &quot;ellipse_groups&quot;, # sidelinechart = FALSE, # sideboxplot = TRUE) plot_Ordination(ResultList = metaphlan2_ps_ordination, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), group_color = c(&quot;blue&quot;, &quot;red&quot;)) Figure 6.1: PCoA 6.4 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 crosstalk_1.2.0 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 ## [11] foreach_1.5.2 htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 ## [16] cluster_2.1.2 limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 ## [21] metagenomeSeq_1.36.0 jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 ## [26] xfun_0.30 crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 ## [31] genefilter_1.76.0 survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 ## [36] gtable_0.3.0 zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 ## [41] RcppZiggurat_0.1.6 Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 ## [46] scales_1.1.1 pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 ## [51] rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 ## [56] DT_0.21 truncnorm_1.0-8 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 ## [61] gplots_3.1.1 RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 ## [66] pkgconfig_2.0.3 XML_3.99-0.9 farver_2.1.0 nnet_7.3-17 sass_0.4.0 ## [71] locfit_1.5-9.5 utf8_1.2.2 tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 ## [76] reshape2_1.4.4 AnnotationDbi_1.56.2 munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 ## [81] cachem_1.0.6 cli_3.2.0 generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 ## [86] broom_0.7.12 evaluate_0.15 biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 ## [91] yaml_2.3.5 knitr_1.37 bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 ## [96] purrr_0.3.4 KEGGREST_1.34.0 coin_1.4-2 nlme_3.1-155 mbzinb_0.2 ## [101] compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 ## [106] geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 lattice_0.20-45 ## [111] Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 ## [116] pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 ## [121] cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 ## [126] gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 ## [131] assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 ## [136] multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 ## [141] tidyr_1.2.0 Rfast_2.0.6 rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 ## [146] lubridate_1.8.0 base64enc_0.1-3 "],["microbial-composition.html", "Chapter 7 Microbial composition 7.1 Stacked barplot 7.2 Core microbiota 7.3 Systematic Information", " Chapter 7 Microbial composition Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) A whole picture of the microbial composition. 7.1 Stacked barplot XVIZ package plot_stacked_bar_XIVZ( phyloseq = metaphlan2_ps_species, level = &quot;Phylum&quot;, feature = &quot;Group&quot;) Figure 7.1: Microbial composition in XVIZ XMAS package plot_StackBarPlot( ps=metaphlan2_ps_species, taxa_level=&quot;Phylum&quot;, group = &quot;Group&quot;, cluster = TRUE) Figure 7.2: Microbial composition 7.2 Core microbiota prevalences &lt;- seq(0.05, 1, 0.05) detections &lt;- 10^seq(log10(1e-3), log10(0.2), length = 10) pl_core &lt;- plot_core_taxa(metaphlan2_ps_species, plot.type = &quot;heatmap&quot;, colours = gray(seq(0, 1, length=5)), prevalences = prevalences, detections = detections, min.prevalence = 0.5)+ xlab(&quot;Detection Threshold (Relative Abundance (%))&quot;) pl_core Figure 7.3: Core taxa The degree of color indicates the size of abundance and prevalence. Use core_members to obtain the core taxa. detection for abundance and prevalence for occurrence. core_taxa_name &lt;- core_members(metaphlan2_ps_species, detection = 0.01, prevalence = 0.5) print(core_taxa_name) ## [1] &quot;s__Bacteroides_uniformis&quot; &quot;s__Bacteroides_vulgatus&quot; &quot;s__Faecalibacterium_prausnitzii&quot; ## [4] &quot;s__Ruminococcus_sp_5_1_39BFAA&quot; Result: Only 4 genera (s__Bacteroides_uniformis, s__Bacteroides_vulgatus, s__Faecalibacterium_prausnitzii and s__Ruminococcus_sp_5_1_39BFAA) passed the threshold of detection and prevalence which we choose. 7.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 crosstalk_1.2.0 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 ## [11] foreach_1.5.2 htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 ## [16] cluster_2.1.2 limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 ## [21] metagenomeSeq_1.36.0 jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 ## [26] xfun_0.30 crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 ## [31] genefilter_1.76.0 survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 ## [36] gtable_0.3.0 zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 ## [41] RcppZiggurat_0.1.6 Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 ## [46] scales_1.1.1 pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 ## [51] rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 ## [56] DT_0.21 truncnorm_1.0-8 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 ## [61] gplots_3.1.1 RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 ## [66] pkgconfig_2.0.3 XML_3.99-0.9 farver_2.1.0 nnet_7.3-17 sass_0.4.0 ## [71] locfit_1.5-9.5 utf8_1.2.2 tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 ## [76] reshape2_1.4.4 AnnotationDbi_1.56.2 munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 ## [81] cachem_1.0.6 cli_3.2.0 generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 ## [86] broom_0.7.12 evaluate_0.15 biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 ## [91] yaml_2.3.5 knitr_1.37 bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 ## [96] purrr_0.3.4 KEGGREST_1.34.0 coin_1.4-2 nlme_3.1-155 mbzinb_0.2 ## [101] compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 ## [106] geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 lattice_0.20-45 ## [111] Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 ## [116] pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 ## [121] cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 ## [126] gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 ## [131] assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 ## [136] multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 ## [141] tidyr_1.2.0 Rfast_2.0.6 rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 ## [146] lubridate_1.8.0 base64enc_0.1-3 "],["differential-analysis.html", "Chapter 8 Differential Analysis 8.1 Filtering &amp; Trimming 8.2 Liner discriminant analysis (LDA) effect size (LEfSe) 8.3 Wilcoxon Rank-Sum test 8.4 Dominant taxa 8.5 Multiple differential analysis by one function 8.6 Systematic Information", " Chapter 8 Differential Analysis Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) library(SummarizedExperiment) There are more than 10 approaches to perform differential analysis. Here, we choose two of them and recommend users going to Chapter 10 to see more details. 8.1 Filtering &amp; Trimming We suggest that filtering taxa with low abundance (the summarized value under cutoff: 1e-4) and trimming taxa with low prevalence (default: 0.2). 8.1.1 Filtering the low relative abundance or unclassified taxa by the threshold (total counts &lt; 1e-4) metaphlan2_ps_species_filter &lt;- run_filter(metaphlan2_ps_species, cutoff = 1e-4, unclass = TRUE) metaphlan2_ps_species_filter ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 171 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 171 taxa by 7 taxonomic ranks ] 8.1.2 Trimming the taxa with low occurrence less than threshold metaphlan2_ps_species_filter_trim &lt;- run_trim(metaphlan2_ps_species_filter, cutoff = 0.2, trim = &quot;feature&quot;) metaphlan2_ps_species_filter_trim ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 109 taxa and 22 samples ] ## sample_data() Sample Data: [ 22 samples by 2 sample variables ] ## tax_table() Taxonomy Table: [ 109 taxa by 7 taxonomic ranks ] 8.2 Liner discriminant analysis (LDA) effect size (LEfSe) Calculation metaphlan2_ps_lefse &lt;- run_lefse( metaphlan2_ps_species_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), norm = &quot;CPM&quot;, Lda = 0) head(metaphlan2_ps_lefse) ## TaxaID Block Enrichment LDA_Score EffectSize Log2FoldChange (Median)\\nAA_vs_BB ## 1 s__Bacteroides_thetaiotaomicron 7_AA vs 15_BB AA -4.510092 3.264270 5.365930 ## 2 s__Streptococcus_parasanguinis 7_AA vs 15_BB BB 3.629399 2.118538 -3.570239 ## 3 s__Dorea_longicatena 7_AA vs 15_BB BB 3.899713 3.282368 NA ## 4 s__Ruminococcus_torques 7_AA vs 15_BB BB 3.948394 1.993293 -2.695141 ## 5 s__Ruminococcus_obeum 7_AA vs 15_BB BB 3.981537 3.288750 -5.130695 ## 6 s__Eubacterium_hallii 7_AA vs 15_BB BB 4.006574 2.762474 NA ## Median Abundance\\n(All) Median Abundance\\nAA Median Abundance\\nBB Log2FoldChange (Mean)\\nAA_vs_BB Mean Abundance\\n(All) ## 1 3629.3802 46588.1306 1129.717 3.207505 24735.889 ## 2 1215.9394 149.3142 1773.577 -0.410051 6273.380 ## 3 972.1956 0.0000 9620.775 -7.317298 7657.442 ## 4 4796.7182 1076.8522 6973.878 -2.516743 10440.883 ## 5 8347.2765 354.8131 12430.616 -2.699162 10757.107 ## 6 5235.2856 0.0000 12282.510 -3.951275 10773.494 ## Mean Abundance\\nAA Mean Abundance\\nBB Occurrence (100%)\\n(All) Occurrence (100%)\\nAA Occurrence (100%)\\nBB Odds Ratio (95% CI) ## 1 63103.12565 6831.179 86.36 100.00 80.00 0.055 (-5.6;5.7) ## 2 5124.74102 6809.412 81.82 57.14 93.33 1.2 (1.5;0.86) ## 3 70.21339 11198.149 63.64 42.86 73.33 2.7e+14 (2.7e+14;2.7e+14) ## 4 2474.05445 14158.736 95.45 85.71 100.00 1500 (1600;1500) ## 5 2266.52678 14719.378 90.91 71.43 100.00 25 (31;18) ## 6 991.57942 15338.388 63.64 42.86 73.33 170 (180;160) Visualization plot_lefse( da_res = metaphlan2_ps_lefse, x_index = &quot;LDA_Score&quot;, x_index_cutoff = 2, group_color = c(&quot;green&quot;, &quot;red&quot;)) Figure 8.1: Lefse analysis 8.3 Wilcoxon Rank-Sum test Calculation metaphlan2_ps_wilcox &lt;- run_wilcox( metaphlan2_ps_species_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;)) head(metaphlan2_ps_wilcox) ## TaxaID Block Enrichment EffectSize Statistic Pvalue AdjustedPvalue Log2FoldChange (Median)\\nAA_vs_BB ## 1 s__Alistipes_finegoldii 7_AA vs 15_BB Nonsignif 0.7750714 75.0 0.08188173 0.3957617 NA ## 2 s__Alistipes_indistinctus 7_AA vs 15_BB Nonsignif 0.1145436 68.0 0.17792767 0.5431476 NA ## 3 s__Alistipes_onderdonkii 7_AA vs 15_BB Nonsignif 0.1879840 66.5 0.29869756 0.6107827 NA ## 4 s__Alistipes_putredinis 7_AA vs 15_BB Nonsignif 1.5991223 54.0 0.94099183 0.9745987 NA ## 5 s__Alistipes_shahii 7_AA vs 15_BB Nonsignif 1.0331682 71.0 0.17515058 0.5431476 NA ## 6 s__Bacteroides_caccae 7_AA vs 15_BB Nonsignif 0.2236323 63.0 0.45130356 0.7478745 NA ## Median Abundance\\n(All) Median Abundance\\nAA Median Abundance\\nBB Log2FoldChange (Rank)\\nAA_vs_BB Mean Rank Abundance\\nAA ## 1 0.00000000 0.0027362 0.00000 0.55679725 14.71 ## 2 0.00000000 0.0000000 0.00000 0.38896713 13.71 ## 3 0.00000000 0.0002823 0.00000 0.35298403 13.50 ## 4 0.00016915 0.0000000 0.00022 0.03870725 11.71 ## 5 0.00012580 0.0062474 0.00000 0.46134594 14.14 ## 6 0.00020790 0.0004158 0.00000 0.26748031 13.00 ## Mean Rank Abundance\\nBB Occurrence (100%)\\n(All) Occurrence (100%)\\nAA Occurrence (100%)\\nBB Odds Ratio (95% CI) ## 1 10.00 40.91 57.14 33.33 0.0025 (-12;12) ## 2 10.47 27.27 42.86 20.00 0.0085 (-9.3;9.4) ## 3 10.57 45.45 57.14 40.00 0.37 (-1.6;2.3) ## 4 11.40 54.55 42.86 60.00 0.47 (-0.99;1.9) ## 5 10.27 50.00 57.14 46.67 0.17 (-3.2;3.6) ## 6 10.80 50.00 57.14 46.67 0.039 (-6.3;6.4) Volcano plot_volcano( metaphlan2_ps_wilcox, group_names = c(&quot;AA&quot;, &quot;BB&quot;), x_index = &quot;Log2FoldChange (Rank)\\nAA_vs_BB&quot;, x_index_cutoff = 0.5, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.05, group_color = c(&quot;red&quot;, &quot;grey&quot;, &quot;blue&quot;), topN = 4, taxa_name = &quot;s__Megamonas_rupellensis&quot;) Figure 8.2: Wilcoxon Rank-Sum test 8.4 Dominant taxa Display the significant taxa with selection using boxplot. plot_topN_boxplot( ps = metaphlan2_ps_species_filter_trim, da_res = metaphlan2_ps_wilcox, x_index = &quot;Log2FoldChange (Rank)\\nAA_vs_BB&quot;, x_index_cutoff = 0.5, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.05, topN = 4, group = &quot;Group&quot;) Figure 8.3: Dominant Taxa 8.5 Multiple differential analysis by one function here, we provide the run_multiple_da for obtaining the results list from multiple differential analysis methods. multiple_res &lt;- run_multiple_da( metaphlan2_ps_species_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), da_method = c(&quot;wilcox&quot;, &quot;limma_voom&quot;, &quot;ttest&quot;)) names(multiple_res) ## [1] &quot;wilcox&quot; &quot;limma_voom&quot; &quot;ttest&quot; plot results plot_multiple_DA( Multip_DA_res = multiple_res, x_index_list = c(&quot;Log2FoldChange (Rank)\\nAA_vs_BB&quot;, &quot;logFC&quot;, &quot;Log2FoldChange (geometricmean)\\nAA_vs_BB&quot;), x_index_cutoff = 0, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.5, cellwidth = 35, cellheight = 10, fontsize_number = 15) Figure 8.4: Multiple DA results 8.6 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 htmlwidgets_1.5.4 ## [6] BiocParallel_1.28.3 munsell_0.5.0 codetools_0.2-18 DT_0.21 withr_2.5.0 ## [11] colorspace_2.0-3 highr_0.9 knitr_1.37 rstudioapi_0.13 pscl_1.5.5 ## [16] robustbase_0.93-9 bayesm_3.1-4 ggsignif_0.6.3 labeling_0.4.2 mbzinb_0.2 ## [21] GenomeInfoDbData_1.2.7 bit64_4.0.5 farver_2.1.0 pheatmap_1.0.12 rhdf5_2.38.1 ## [26] vctrs_0.3.8 generics_0.1.2 TH.data_1.1-0 xfun_0.30 R6_2.5.1 ## [31] locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 rhdf5filters_1.6.0 cachem_1.0.6 ## [36] DelayedArray_0.20.0 assertthat_0.2.1 scales_1.1.1 multcomp_1.4-18 nnet_7.3-17 ## [41] gtable_0.3.0 sandwich_3.0-1 rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 ## [46] rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 yaml_2.3.5 reshape2_1.4.4 ## [51] abind_1.4-5 crosstalk_1.2.0 backports_1.4.1 Rfast_2.0.6 Hmisc_4.6-0 ## [56] tensorA_0.36.2 tools_4.1.2 bookdown_0.24 zCompositions_1.4.0 ellipsis_0.3.2 ## [61] gplots_3.1.1 jquerylib_0.1.4 biomformat_1.22.0 RColorBrewer_1.1-2 plyr_1.8.6 ## [66] base64enc_0.1-3 zlibbioc_1.40.0 purrr_0.3.4 RCurl_1.98-1.6 rpart_4.1.16 ## [71] Wrench_1.12.0 cowplot_1.1.1 zoo_1.8-9 ggrepel_0.9.1 cluster_2.1.2 ## [76] data.table_1.14.2 forestplot_2.0.1 truncnorm_1.0-8 mvtnorm_1.1-3 ALDEx2_1.26.0 ## [81] evaluate_0.15 xtable_1.8-4 XML_3.99-0.9 jpeg_0.1-9 gridExtra_2.3 ## [86] shape_1.4.6 compiler_4.1.2 KernSmooth_2.23-20 crayon_1.5.0 htmltools_0.5.2 ## [91] mgcv_1.8-39 Formula_1.2-4 tidyr_1.2.0 geneplotter_1.72.0 libcoin_1.0-9 ## [96] lubridate_1.8.0 DBI_1.1.2 corrplot_0.92 MASS_7.3-55 compositions_2.0-4 ## [101] Matrix_1.4-0 ade4_1.7-18 car_3.0-12 permute_0.9-7 cli_3.2.0 ## [106] parallel_4.1.2 igraph_1.2.11 pkgconfig_2.0.3 coin_1.4-2 foreign_0.8-82 ## [111] foreach_1.5.2 annotate_1.72.0 bslib_0.3.1 multtest_2.50.0 XVector_0.34.0 ## [116] NADA_1.6-1.1 stringr_1.4.0 digest_0.6.29 vegan_2.5-7 Biostrings_2.62.0 ## [121] rmarkdown_2.13 cellranger_1.1.0 edgeR_3.36.0 gtools_3.9.2 modeltools_0.2-23 ## [126] lifecycle_1.0.1 nlme_3.1-155 jsonlite_1.8.0 Rhdf5lib_1.16.0 carData_3.0-5 ## [131] limma_3.50.1 fansi_1.0.2 pillar_1.7.0 lattice_0.20-45 DEoptimR_1.0-10 ## [136] KEGGREST_1.34.0 fastmap_1.1.0 httr_1.4.2 survival_3.3-1 png_0.1-7 ## [141] iterators_1.0.14 glmnet_4.1-3 bit_4.0.4 stringi_1.7.6 sass_0.4.0 ## [146] metagenomeSeq_1.36.0 blob_1.2.2 DESeq2_1.34.0 latticeExtra_0.6-29 caTools_1.18.2 ## [151] memoise_2.0.1 ape_5.6-2 "],["test-example.html", "Chapter 9 Test Example 9.1 Loading packages 9.2 Loading data 9.3 Step1: Convert inputs into phyloseq data 9.4 Step2: Transform limit of detection (LOD) into Zeros 9.5 Step3: BRS checking 9.6 Step4: Extracting specific taxonomic level 9.7 Step7: GlobalView 9.8 Step6: Differential Analysis 9.9 Systematic Information", " Chapter 9 Test Example 9.1 Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) library(SummarizedExperiment) library(readxl) 9.2 Loading data metaphlan2_res &lt;- read.table(&quot;DataSet/RawData/merged_metaphlan2.tsv&quot;, header = TRUE, stringsAsFactors = FALSE) %&gt;% tibble::rownames_to_column(&quot;ID&quot;) metadata &lt;- read_xlsx(&quot;DataSet/RawData/诺禾宏基因组678月-ZH.xlsx&quot;, sheet = 3) 9.3 Step1: Convert inputs into phyloseq data metaphlan2_res_list &lt;- import_metaphlan_taxa(metaphlan2_res, taxa_level = &quot;Species&quot;) tax_tab &lt;- metaphlan2_res_list$tax_tab otu_tab &lt;- metaphlan2_res_list$abu_tab colnames(otu_tab) &lt;- gsub(&quot;X&quot;, &quot;S_&quot;, colnames(otu_tab)) sam_tab &lt;- metadata %&gt;% data.frame() %&gt;% dplyr::mutate(Group=ifelse(SampleType == &quot;粪便&quot;, &quot;Stool&quot;, ifelse(SampleType == &quot;QC&quot;, &quot;QC&quot;, &quot;Product&quot;))) %&gt;% dplyr::select(SampleTubeID, Group, everything()) rownames(sam_tab) &lt;- paste0(&quot;S_&quot;, sam_tab$SeqID_MGS) overlap_samples &lt;- intersect(rownames(sam_tab), colnames(otu_tab)) otu_tab_cln &lt;- otu_tab[, match(overlap_samples, colnames(otu_tab))] sam_tab_cln &lt;- sam_tab[match(overlap_samples, rownames(sam_tab)), ] rownames(sam_tab_cln) &lt;- overlap_samples metaphlan2_ps &lt;- get_metaphlan_phyloseq(otu_tab = otu_tab_cln, sam_tab = sam_tab_cln, tax_tab = tax_tab) metaphlan2_ps ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 328 taxa and 145 samples ] ## sample_data() Sample Data: [ 145 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 328 taxa by 7 taxonomic ranks ] if (!dir.exists(&quot;DataSet/Step1/&quot;)) { dir.create(&quot;DataSet/Step1/&quot;) } saveRDS(metaphlan2_ps, &quot;DataSet/Step1/Donor_MGS_phyloseq.RDS&quot;, compress = TRUE) 9.4 Step2: Transform limit of detection (LOD) into Zeros # species metaphlan2_ps_species_LOD &lt;- aggregate_LOD_taxa(metaphlan2_ps, taxa_level = &quot;Species&quot;, cutoff = 1e-04) # genus metaphlan2_ps_genus_LOD &lt;- aggregate_LOD_taxa(metaphlan2_ps, taxa_level = &quot;Genus&quot;, cutoff = 1e-04) # order metaphlan2_ps_order_LOD &lt;- aggregate_LOD_taxa(metaphlan2_ps, taxa_level = &quot;Order&quot;, cutoff = 1e-04) if (!dir.exists(&quot;DataSet/Step2/&quot;)) { dir.create(&quot;DataSet/Step2/&quot;) } saveRDS(metaphlan2_ps_species_LOD, &quot;DataSet/Step2/Donor_MGS_phyloseq_species_LOD.RDS&quot;, compress = TRUE) saveRDS(metaphlan2_ps_genus_LOD, &quot;DataSet/Step2/Donor_MGS_phyloseq_genus_LOD.RDS&quot;, compress = TRUE) saveRDS(metaphlan2_ps_order_LOD, &quot;DataSet/Step2/Donor_MGS_phyloseq_order_LOD.RDS&quot;, compress = TRUE) 9.5 Step3: BRS checking metaphlan2_ps_species_LOD &lt;- readRDS(&quot;DataSet/Step2/Donor_MGS_phyloseq_species_LOD.RDS&quot;) tail(metaphlan2_ps_species_LOD@sam_data %&gt;% data.frame()) ## SampleTubeID Group Date_Sequencing ProductID SampleType ProductBatch Date_Sampling Date_Receiving SeqID_MGS SeqID_16s ## S_7769 GGM50-210730 Stool 2021-08-03 M50 粪便 CYM50-210735 2021.07.30 2021-08-06 7769 7929 ## S_7770 CYM50-210735-0727 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.27 2021-08-06 7770 7930 ## S_7771 CYM50-210735-0728 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.28 2021-08-06 7771 7931 ## S_7772 CYM50-210735-0729 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.29 2021-08-06 7772 7932 ## S_7773 CYM50-210735-0730 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.30 2021-08-06 7773 7933 ## S_7222 Community QC &lt;NA&gt; Ref QC &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; 7222 7327 ## Pipeline_MGS Pipeline_16s ## S_7769 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7770 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7771 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7772 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7773 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7222 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 run_RefCheck( ps=metaphlan2_ps_species_LOD, BRS_ID=&quot;S_7222&quot;, Reference=NULL, Ref_type=&quot;MGS&quot;, Save=NULL) ## 7682 7683 7684 7685 7842 7843 7844 7845 S_7222 mean ## Escherichia_coli 8.77158 8.33337 7.70416 8.11247 10.44118 10.33823 9.96261 11.06988 9.85431 9.398643 ## Enterococcus_faecalis 11.46778 12.46200 11.92117 11.95884 13.71474 13.67805 13.21782 13.27297 17.19286 13.209581 ## Impurity_level 7.33876 7.34799 7.14891 6.47250 8.88190 9.72198 9.72162 10.57600 72.95000 15.573296 ## Evaluation ## Escherichia_coli S_7222 didn&#39;t pass the threshold (2022-06-01 18:37:56). ## Enterococcus_faecalis S_7222 didn&#39;t pass the threshold (2022-06-01 18:37:56). ## Impurity_level S_7222 didn&#39;t pass the threshold (2022-06-01 18:37:56). metaphlan2_ps_remove_BRS &lt;- get_GroupPhyloseq( ps = metaphlan2_ps, group = &quot;Group&quot;, group_names = &quot;QC&quot;) metaphlan2_ps_remove_BRS ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 328 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 328 taxa by 7 taxonomic ranks ] if (!dir.exists(&quot;DataSet/Step3/&quot;)) { dir.create(&quot;DataSet/Step3/&quot;) } saveRDS(metaphlan2_ps_remove_BRS, &quot;DataSet/Step3/Donor_MGS_phyloseq_remove_BRS.RDS&quot;, compress = TRUE) 9.6 Step4: Extracting specific taxonomic level metaphlan2_ps_remove_BRS &lt;- readRDS(&quot;DataSet/Step3/Donor_MGS_phyloseq_remove_BRS.RDS&quot;) metaphlan2_ps_remove_BRS_LOD_species &lt;- aggregate_LOD_taxa(metaphlan2_ps_remove_BRS, taxa_level = &quot;Species&quot;, cutoff = 1e-04) metaphlan2_ps_remove_BRS_LOD_species ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 180 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 180 taxa by 7 taxonomic ranks ] metaphlan2_ps_remove_BRS_LOD_genus &lt;- aggregate_LOD_taxa(metaphlan2_ps_remove_BRS, taxa_level = &quot;Genus&quot;, cutoff = 1e-04) metaphlan2_ps_remove_BRS_LOD_genus ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 67 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 67 taxa by 6 taxonomic ranks ] if (!dir.exists(&quot;DataSet/Step4/&quot;)) { dir.create(&quot;DataSet/Step4/&quot;) } saveRDS(metaphlan2_ps_remove_BRS_LOD_species, &quot;DataSet/Step4/Donor_MGS_phyloseq_remove_BRS_LOD_species.RDS&quot;, compress = TRUE) saveRDS(metaphlan2_ps_remove_BRS_LOD_genus, &quot;DataSet/Step4/Donor_MGS_phyloseq_remove_BRS_LOD_genus.RDS&quot;, compress = TRUE) 9.7 Step7: GlobalView metaphlan2_ps_remove_BRS_LOD_species &lt;- readRDS(&quot;DataSet/Step4/Donor_MGS_phyloseq_remove_BRS_LOD_species.RDS&quot;) # alpha metaphlan2_ps_remove_BRS_LOD_species_alpha &lt;- run_alpha_diversity(ps=metaphlan2_ps_remove_BRS_LOD_species, measures = c(&quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot;)) plot_boxplot(data=metaphlan2_ps_remove_BRS_LOD_species_alpha, y_index = c(&quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot;), group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), group_color = c(&quot;red&quot;, &quot;blue&quot;)) Figure 9.1: diversity and ordination and composition(Example) # beta metaphlan2_ps_remove_BRS_LOD_species_beta &lt;- run_beta_diversity(ps=metaphlan2_ps_remove_BRS_LOD_species, method = &quot;bray&quot;) plot_distance_corrplot(metaphlan2_ps_remove_BRS_LOD_species_beta$BetaDistance) Figure 9.2: diversity and ordination and composition(Example) # permanova run_permanova(ps=metaphlan2_ps_remove_BRS_LOD_species, method = &quot;bray&quot;, columns = &quot;Group&quot;) ## SumsOfSample Df SumsOfSqs MeanSqs F.Model R2 Pr(&gt;F) AdjustedPvalue ## Group 144 1 1.180628 1.180628 6.109058 0.04124703 0.001 0.001 # beta dispersion beta_df &lt;- run_beta_diversity(ps=metaphlan2_ps_remove_BRS_LOD_species, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.01163 0.011631 1.0661 999 0.312 ## Residuals 142 1.54928 0.010910 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## Product Stool ## Product 0.308 ## Stool 0.30359 # ordination metaphlan2_ps_ordination &lt;- run_ordination( ps = metaphlan2_ps_remove_BRS_LOD_species, group = &quot;Group&quot;, method = &quot;PCoA&quot;) plot_Ordination(ResultList = metaphlan2_ps_ordination, group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), group_color = c(&quot;blue&quot;, &quot;red&quot;)) Figure 9.3: diversity and ordination and composition(Example) # Microbial composition plot_stacked_bar_XIVZ( phyloseq = metaphlan2_ps_remove_BRS_LOD_species, level = &quot;Phylum&quot;, feature = &quot;Group&quot;) Figure 9.4: diversity and ordination and composition(Example) 9.8 Step6: Differential Analysis metaphlan2_ps_remove_BRS_LOD_species &lt;- readRDS(&quot;DataSet/Step4/Donor_MGS_phyloseq_remove_BRS_LOD_species.RDS&quot;) # filter &amp; trim metaphlan2_ps_remove_BRS_LOD_species_filter &lt;- run_filter(metaphlan2_ps_remove_BRS_LOD_species, cutoff = 1e-4, unclass = TRUE) metaphlan2_ps_remove_BRS_LOD_species_filter_trim &lt;- run_trim(metaphlan2_ps_remove_BRS_LOD_species_filter, cutoff = 0.2, trim = &quot;feature&quot;) metaphlan2_ps_remove_BRS_LOD_species_filter_trim ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 107 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 107 taxa by 7 taxonomic ranks ] # lefse metaphlan2_ps_lefse &lt;- run_lefse( metaphlan2_ps_remove_BRS_LOD_species_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), Lda = 2) plot_lefse( da_res = metaphlan2_ps_lefse, x_index = &quot;LDA_Score&quot;, x_index_cutoff = 2, group_color = c(&quot;green&quot;, &quot;red&quot;)) Figure 9.5: Differential Analysis (Example) metaphlan2_ps_wilcox &lt;- run_wilcox( metaphlan2_ps_remove_BRS_LOD_species_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;)) plot_volcano( metaphlan2_ps_wilcox, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), x_index = &quot;Log2FoldChange (Rank)\\nStool_vs_Product&quot;, x_index_cutoff = 0.5, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.05, group_color = c(&quot;red&quot;, &quot;grey&quot;, &quot;blue&quot;), topN = 5) Figure 9.6: Differential Analysis (Example) if (!dir.exists(&quot;DataSet/Step8/&quot;)) { dir.create(&quot;DataSet/Step8/&quot;) } saveRDS(metaphlan2_ps_remove_BRS_LOD_species_filter_trim, &quot;DataSet/Step6/Donor_MGS_phyloseq_remove_BRS_LOD_species_filter_trim.RDS&quot;, compress = TRUE) 9.9 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.1.2 RSQLite_2.2.10 AnnotationDbi_1.56.2 htmlwidgets_1.5.4 ## [6] BiocParallel_1.28.3 munsell_0.5.0 codetools_0.2-18 DT_0.21 withr_2.5.0 ## [11] colorspace_2.0-3 highr_0.9 knitr_1.37 rstudioapi_0.13 pscl_1.5.5 ## [16] robustbase_0.93-9 bayesm_3.1-4 ggsignif_0.6.3 labeling_0.4.2 mbzinb_0.2 ## [21] GenomeInfoDbData_1.2.7 bit64_4.0.5 farver_2.1.0 pheatmap_1.0.12 rhdf5_2.38.1 ## [26] vctrs_0.3.8 generics_0.1.2 TH.data_1.1-0 xfun_0.30 R6_2.5.1 ## [31] locfit_1.5-9.5 RcppZiggurat_0.1.6 bitops_1.0-7 rhdf5filters_1.6.0 cachem_1.0.6 ## [36] DelayedArray_0.20.0 assertthat_0.2.1 scales_1.1.1 multcomp_1.4-18 nnet_7.3-17 ## [41] gtable_0.3.0 sandwich_3.0-1 rlang_1.0.2 genefilter_1.76.0 splines_4.1.2 ## [46] rstatix_0.7.0 broom_0.7.12 checkmate_2.0.0 yaml_2.3.5 reshape2_1.4.4 ## [51] abind_1.4-5 crosstalk_1.2.0 backports_1.4.1 Rfast_2.0.6 Hmisc_4.6-0 ## [56] tensorA_0.36.2 tools_4.1.2 bookdown_0.24 zCompositions_1.4.0 ellipsis_0.3.2 ## [61] gplots_3.1.1 jquerylib_0.1.4 biomformat_1.22.0 RColorBrewer_1.1-2 plyr_1.8.6 ## [66] base64enc_0.1-3 zlibbioc_1.40.0 purrr_0.3.4 RCurl_1.98-1.6 rpart_4.1.16 ## [71] Wrench_1.12.0 cowplot_1.1.1 zoo_1.8-9 ggrepel_0.9.1 cluster_2.1.2 ## [76] data.table_1.14.2 forestplot_2.0.1 truncnorm_1.0-8 mvtnorm_1.1-3 ALDEx2_1.26.0 ## [81] evaluate_0.15 xtable_1.8-4 XML_3.99-0.9 jpeg_0.1-9 gridExtra_2.3 ## [86] shape_1.4.6 compiler_4.1.2 KernSmooth_2.23-20 crayon_1.5.0 htmltools_0.5.2 ## [91] mgcv_1.8-39 Formula_1.2-4 tidyr_1.2.0 geneplotter_1.72.0 libcoin_1.0-9 ## [96] lubridate_1.8.0 DBI_1.1.2 corrplot_0.92 MASS_7.3-55 compositions_2.0-4 ## [101] Matrix_1.4-0 ade4_1.7-18 car_3.0-12 permute_0.9-7 cli_3.2.0 ## [106] parallel_4.1.2 igraph_1.2.11 pkgconfig_2.0.3 coin_1.4-2 foreign_0.8-82 ## [111] foreach_1.5.2 annotate_1.72.0 bslib_0.3.1 multtest_2.50.0 XVector_0.34.0 ## [116] NADA_1.6-1.1 stringr_1.4.0 digest_0.6.29 vegan_2.5-7 Biostrings_2.62.0 ## [121] rmarkdown_2.13 cellranger_1.1.0 edgeR_3.36.0 gtools_3.9.2 modeltools_0.2-23 ## [126] lifecycle_1.0.1 nlme_3.1-155 jsonlite_1.8.0 Rhdf5lib_1.16.0 carData_3.0-5 ## [131] limma_3.50.1 fansi_1.0.2 pillar_1.7.0 lattice_0.20-45 DEoptimR_1.0-10 ## [136] KEGGREST_1.34.0 fastmap_1.1.0 httr_1.4.2 survival_3.3-1 png_0.1-7 ## [141] iterators_1.0.14 glmnet_4.1-3 bit_4.0.4 stringi_1.7.6 sass_0.4.0 ## [146] metagenomeSeq_1.36.0 blob_1.2.2 DESeq2_1.34.0 latticeExtra_0.6-29 caTools_1.18.2 ## [151] memoise_2.0.1 ape_5.6-2 "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
